(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    308682,       7338]
NotebookOptionsPosition[    299240,       7181]
NotebookOutlinePosition[    299646,       7197]
CellTagsIndexPosition[    299603,       7194]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Clear Everything", "Section",
 CellChangeTimes->{{3.6773415796718187`*^9, 3.677341587609486*^9}, {
  3.6774116156550407`*^9, 3.677411630094652*^9}, {3.6774141980360727`*^9, 
  3.677414203200438*^9}, {3.677500094832984*^9, 3.6775000961756697`*^9}, {
  3.6775859034094687`*^9, 3.677585905448139*^9}, {3.732349424400402*^9, 
  3.732349424734907*^9}},ExpressionUUID->"8e05bc19-2993-4905-85ee-\
d7bf15563fee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.677341594873004*^9, 3.677341601956559*^9}, {
   3.6773416351397133`*^9, 3.677341635430009*^9}, {3.677411463554161*^9, 
   3.677411463689904*^9}, {3.677411634779175*^9, 3.677411636993269*^9}, {
   3.677414207971932*^9, 3.6774142089198923`*^9}, {3.677491467351344*^9, 
   3.6774914681365128`*^9}, 3.677585853678219*^9, {3.678645529930112*^9, 
   3.678645530188652*^9}, {3.678818728618877*^9, 3.678818742469584*^9}, 
   3.678976259614951*^9, {3.732349391577814*^9, 3.732349391856412*^9}, 
   3.733032816411669*^9, {3.737270928568103*^9, 3.737270956700658*^9}, 
   3.737880839779789*^9, {3.7378850076682873`*^9, 3.737885019821815*^9}, {
   3.7378850843347597`*^9, 3.737885085189253*^9}, {3.741526505948052*^9, 
   3.741526506514371*^9}, {3.7523179059984827`*^9, 3.752317906417932*^9}, {
   3.7673504037186737`*^9, 3.767350404028522*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"317c3153-e78a-4806-b09b-e2c3428bd8f7"]
}, Closed]],

Cell[CellGroupData[{

Cell["Define Functions", "Section",
 CellChangeTimes->{{3.770656726063299*^9, 
  3.7706567284989853`*^9}},ExpressionUUID->"b77a3eab-9c73-4334-a97e-\
3147300f1334"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Useful", " ", "coefficient"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[ScriptCapitalA]", "[", 
      RowBox[{"M_", ",", "k_", ",", "kp_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"\[ScriptCapitalA]", "[", 
       RowBox[{"M", ",", "k", ",", "kp"}], "]"}], "=", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "n", ",", "Km", ",", "Kp", ",", "perms", ",", "multiplicity", ",", 
          "parts", ",", "qvecs"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", "=", 
          RowBox[{"Length", "[", "k", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"perms", "=", 
          RowBox[{"Permutations", "[", "kp", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"multiplicity", "=", 
          RowBox[{"Times", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Tally", "[", "kp", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "!"}], ")"}]}]}], ";",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"multiplicity", "*", "\[IndentingNewLine]", 
           RowBox[{"Sum", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Km", "=", 
               RowBox[{
                RowBox[{"k", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], "+", 
                RowBox[{"kpp", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Kp", "=", 
               RowBox[{
                RowBox[{"k", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", 
                RowBox[{"kpp", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"parts", "=", 
               RowBox[{"IntegerPartitions", "[", 
                RowBox[{"M", ",", "n"}], "]"}]}], ";", 
              RowBox[{"parts", "=", 
               RowBox[{"PadRight", "[", 
                RowBox[{"parts", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Length", "[", "parts", "]"}], ",", "n"}], "}"}]}],
                 "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"parts", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Permutations", "[", "#", "]"}], "&"}], "/@", 
                  "parts"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"qvecs", "=", 
               RowBox[{"Select", "[", 
                RowBox[{"parts", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Min", "[", 
                    RowBox[{
                    FractionBox["Kp", "2"], "-", "#"}], "]"}], 
                   "\[GreaterEqual]", "0"}], "&"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"Times", "@@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Binomial", "[", 
                    RowBox[{"Kp", ",", 
                    RowBox[{"2", "q"}]}], "]"}], 
                   RowBox[{"Pochhammer", "[", 
                    RowBox[{
                    FractionBox["1", "2"], ",", "q"}], "]"}], 
                   RowBox[{"Pochhammer", "[", 
                    RowBox[{
                    FractionBox["1", "2"], ",", "Km"}], "]"}], 
                   RowBox[{"Pochhammer", "[", 
                    RowBox[{
                    RowBox[{"Km", "+", 
                    FractionBox["1", "2"]}], ",", 
                    RowBox[{"Kp", "-", "q"}]}], "]"}]}], ")"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"q", ",", "qvecs"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"kpp", ",", "perms"}], "}"}]}], "]"}]}], "//", 
          "Simplify"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Monomial", " ", "inner", " ", "product", " ", 
     RowBox[{"(", "exact", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"InnerFT", "[", 
      RowBox[{"k_", ",", "kp_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"InnerFT", "[", 
       RowBox[{"k", ",", "kp"}], "]"}], "=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"n", "=", 
           RowBox[{"Length", "[", "k", "]"}]}], ",", "TotDeriv", ",", 
          "TotPerp"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"TotDeriv", "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"k", ",", "2"}], "]"}], "+", 
           RowBox[{"Total", "[", 
            RowBox[{"kp", ",", "2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"TotPerp", "=", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"k", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "+", 
           RowBox[{"Total", "[", 
            RowBox[{"kp", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"OddQ", "[", "TotPerp", "]"}], ",", "0", ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             FractionBox[
              SuperscriptBox["\[Pi]", "2"], 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"4", "\[Pi]"}], ")"}], "n"], 
               SuperscriptBox["2", 
                RowBox[{"n", "-", "4"}]], 
               RowBox[{"Gamma", "[", 
                FractionBox[
                 RowBox[{"TotPerp", "+", "n", "-", "1"}], "2"], "]"}]}]], 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                FractionBox[
                 RowBox[{
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], 
                   RowBox[{
                    FractionBox["TotPerp", "2"], "-", "M"}]], 
                  RowBox[{"Gamma", "[", 
                   RowBox[{
                    FractionBox["TotPerp", "2"], "-", "M", "+", 
                    FractionBox["1", "2"]}], "]"}]}], 
                 RowBox[{"Gamma", "[", 
                  RowBox[{"TotDeriv", "-", "M", "+", 
                   FractionBox["n", "2"]}], "]"}]], 
                RowBox[{"\[ScriptCapitalA]", "[", 
                 RowBox[{"M", ",", "k", ",", "kp"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"M", ",", "0", ",", 
                 FractionBox["TotPerp", "2"]}], "}"}]}], "]"}]}], "//", 
            "Simplify"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Mass", " ", "matrix", " ", "element", " ", "as", " ", "a", " ", "sum", 
     " ", "of", " ", "inner", " ", "products", " ", 
     RowBox[{"(", "exact", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MassFT", "[", 
     RowBox[{"k_", ",", "kp_"}], "]"}], ":=", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"temp", "=", "k"}], ";", 
       RowBox[{
        RowBox[{"temp", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "1"}], "]"}], "]"}], "--"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"InnerFT", "[", 
        RowBox[{"temp", ",", "kp"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "k", "]"}]}], "}"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7706567463121758`*^9, 3.770656747376767*^9}, {
  3.770656803713759*^9, 3.77065690784411*^9}, {3.770657944483615*^9, 
  3.770657946199421*^9}, {3.798104313867508*^9, 3.798104317713996*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"eaeb05b4-5907-43f9-bef9-c51d62833519"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 StyleBox["Nikhil\[CloseCurlyQuote]s",
  IgnoreSpellCheck->True],
 " Fock Space Functions (for checking)"
}], "Section",
 CellChangeTimes->{{3.767294523134709*^9, 3.767294525192512*^9}, {
  3.769848350667965*^9, 3.76984835616721*^9}, {3.770656932281233*^9, 
  3.770656935209609*^9}},ExpressionUUID->"03500836-ede0-496f-978d-\
a084bd17f95d"],

Cell[CellGroupData[{

Cell["\<\
Some Functions to Express Monomials in Momentum Space, Change Variables, etc.\
\
\>", "Subsection",
 CellChangeTimes->{{3.729953554038411*^9, 
  3.72995357941391*^9}},ExpressionUUID->"f6fa6735-b55b-4e96-9791-\
7c43f0a95174"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "makes", " ", "the", " ", "momentum", " ", "space", " ", "monomial", " ", 
     "given", " ", "an", " ", "input", " ", "of", " ", "mono"}], ",", " ", 
    RowBox[{
    "which", " ", "are", " ", "list", " ", "of", " ", "powers", " ", "of", 
     " ", "the", " ", "form", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a1", ",", "b1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"a2", ",", "b2"}], "}"}], ",", "...", ",", 
       RowBox[{"{", 
        RowBox[{"an", ",", "bn"}], "}"}]}], "}"}]}], ",", " ", 
    RowBox[{
    "where", " ", "ai", " ", "are", " ", "the", " ", "minus", " ", 
     "derivatives"}], ",", " ", 
    RowBox[{"bi", " ", "are", " ", "the", " ", "perp", " ", 
     RowBox[{"derivatives", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "these", " ", "functions", " ", "are", " ", "involve", " ", "symbolic", 
     " ", "manipulations"}], ",", " ", 
    RowBox[{
    "so", " ", "they", " ", "are", " ", "obviously", " ", "not", " ", "very", 
     " ", 
     RowBox[{"fast", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"convertMonomial", "[", 
      RowBox[{"mono_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"vars", ",", "varPerm"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vars", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<x\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<y\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"varPerm", "=", 
         RowBox[{"Permutations", "@", "vars"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Plus", "@@", 
         RowBox[{"Times", "@@@", 
          RowBox[{"Times", "@@@", 
           RowBox[{"Table", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"varPerm", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "mono"], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "varPerm"}]}], "}"}]}], "]"}]}]}]}]}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "takes", " ", "in", " ", "coefficients", " ", "and", " ", "monomial", " ",
      "list", " ", "and", " ", "outputs", " ", "the", " ", "basis", " ", 
     "states", " ", "in", " ", "terms", " ", "of", " ", "x_i", " ", "and", 
     " ", "y_i"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"convertWavefxn", "[", 
     RowBox[{"coeffs_", ",", "monoList_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "convMonos", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"coeffs", "\[NotEqual]", 
           RowBox[{"{", "}"}]}], "&&", 
          RowBox[{"monoList", "\[NotEqual]", 
           RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"convMonos", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"convertMonomial", "[", 
              RowBox[{
               RowBox[{"monoList", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "n"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "monoList"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"coeffs", ".", "convMonos"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "commonAssumptions", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"commonAssumptions", "[", "n_", "]"}], ":=", 
     RowBox[{
      RowBox[{"commonAssumptions", "[", "n", "]"}], "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<u\>\"", "<>", 
             RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<m\>\""}], "]"}], 
           ">=", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<u\>\"", "<>", 
             RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<p\>\""}], "]"}], 
           ">=", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"u1PrimeMinus", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"u2PrimeMinus", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"u1PrimePlus", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"u2PrimePlus", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"\[Mu]", "\[LessEqual]", "\[Mu]p"}], ",", 
          RowBox[{
           FractionBox["\[Mu]", "\[Mu]p"], "\[LessEqual]", "1"}], ",", 
          RowBox[{"\[Mu]", "\[Element]", "Reals"}], ",", 
          RowBox[{"\[Mu]", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"\[Mu]p", "\[Element]", "Reals"}], ",", 
          RowBox[{"\[Mu]p", "\[GreaterEqual]", "0"}]}], "}"}]}], "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"generateyTable", "[", 
      RowBox[{"n_", ",", 
       RowBox[{"prime_:", "False"}]}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{"prime", ",", 
       RowBox[{"Reverse", "@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToExpression", "[", "\"\<y1\>\"", "]"}], "->", " ", 
            RowBox[{"-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<y\>\"", "<>", 
                 RowBox[{"ToString", "[", "k", "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "2", ",", "n"}], "}"}]}], "]"}]}]}], "}"}], 
          ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<y\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<yt\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<'\>\""}], "]"}], 
               " ", 
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<up\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<'\>\""}], "]"}], 
               
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<um\>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"k", "-", "1"}], "]"}], "<>", "\"\<'\>\""}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", "i", ",", "n"}], "}"}]}], "]"}]}], "-", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"ToExpression", "[", 
                 RowBox[{"\"\<up\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<'\>\""}], "]"}],
                 "2"], 
               RowBox[{"(", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"\"\<y\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"l", ",", 
                    RowBox[{"i", "+", "1"}], ",", "n"}], "}"}]}], "]"}], 
                ")"}]}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], 
       ",", 
       RowBox[{"Reverse", "@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ToExpression", "[", "\"\<y1\>\"", "]"}], "->", " ", 
            RowBox[{"-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<y\>\"", "<>", 
                 RowBox[{"ToString", "[", "k", "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "2", ",", "n"}], "}"}]}], "]"}]}]}], "}"}], 
          ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<y\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<yt\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}]}], "]"}], " ", 
               RowBox[{"ToExpression", "[", 
                RowBox[{"\"\<up\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}]}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<um\>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"k", "-", "1"}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", "i", ",", "n"}], "}"}]}], "]"}]}], "-", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"ToExpression", "[", 
                 RowBox[{"\"\<up\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"i", "-", "1"}], "]"}]}], "]"}], "2"], 
               RowBox[{"(", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"\"\<y\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"l", ",", 
                    RowBox[{"i", "+", "1"}], ",", "n"}], "}"}]}], "]"}], 
                ")"}]}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"generatexTable", "[", 
      RowBox[{"n_", ",", 
       RowBox[{"prime_:", "False"}]}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{"prime", ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToExpression", "[", "\"\<x1\>\"", "]"}], "->", " ", 
           RowBox[{"Product", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<um\>\"", "<>", 
                RowBox[{"ToString", "[", "k", "]"}], "<>", "\"\<'\>\""}], 
               "]"}], "2"], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], "}"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<x\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<up\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<'\>\""}], "]"}], 
              "2"], " ", 
             RowBox[{"Product", "[", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"ToExpression", "[", 
                 RowBox[{"\"\<um\>\"", "<>", 
                  RowBox[{"ToString", "[", "k", "]"}], "<>", "\"\<'\>\""}], 
                 "]"}], "2"], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "i", ",", 
                 RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ToExpression", "[", "\"\<x1\>\"", "]"}], "->", " ", 
           RowBox[{"Product", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<um\>\"", "<>", 
                RowBox[{"ToString", "[", "k", "]"}]}], "]"}], "2"], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], "}"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<x\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "\[Rule]", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<up\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"i", "-", "1"}], "]"}]}], "]"}], "2"], " ", 
             RowBox[{"Product", "[", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"ToExpression", "[", 
                 RowBox[{"\"\<um\>\"", "<>", 
                  RowBox[{"ToString", "[", "k", "]"}]}], "]"}], "2"], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "i", ",", 
                 RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"generate\[Theta]Table", "[", "...", "]"}], " ", "creates", " ",
       "replacement", " ", "rules", " ", "for", " ", "the", " ", "ytilde", 
      " ", "variables", " ", "in", " ", "temrs", " ", "of", " ", "the", " ", 
      "angular", " ", 
      RowBox[{"coordinates", ".", " ", "The"}], " ", "second", " ", 
      "optional", " ", "argument", " ", "denotes", " ", "which", " ", 
      "subset", " ", "of", " ", "the", " ", "ytilde", " ", "variables", " ", 
      "we", " ", "want", " ", "to", " ", "create", " ", "angular", " ", 
      "variables", " ", 
      RowBox[{"for", ".", " ", "For"}], " ", "example"}], ",", " ", 
     RowBox[{
     "if", " ", "the", " ", "second", " ", "argument", " ", "is", " ", "2"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"we", " ", "create", " ", "n"}], "-", 
      RowBox[{
      "3", " ", "angles", " ", "for", " ", "ytilde_", "2", " ", "up", " ", 
       "to", " ", "ytilde_", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", "-", "1"}], "}"}], ".", " ", "The"}], " ", "third", " ",
        "argument", " ", "is", " ", "if", " ", "we", " ", "want", " ", "a", 
       " ", "solid", " ", "sphere"}]}], ",", " ", 
     RowBox[{
      RowBox[{"with", " ", "the", " ", "default", " ", "radius"}], " ", "=", 
      " ", "1."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"generate\[Theta]Table", "[", 
      RowBox[{"n_", ",", 
       RowBox[{"subset_:", "1"}], ",", 
       RowBox[{"radius_:", "1"}]}], "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<yt\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"n", "-", "k"}], "]"}]}], "]"}], "\[Rule]", 
          RowBox[{"radius", " ", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<C\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"n", "-", "k", "-", "subset"}], "]"}]}], "]"}], 
           RowBox[{"Product", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<S\>\"", "<>", 
               RowBox[{"ToString", "[", "l", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"l", ",", 
               RowBox[{"n", "-", "k", "-", "subset", "+", "1"}], ",", 
               RowBox[{"n", "-", "1", "-", "subset"}]}], "}"}]}], "]"}]}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"n", "-", "1", "-", "subset"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<yt\>\"", "<>", 
           RowBox[{"ToString", "[", "subset", "]"}]}], "]"}], "\[Rule]", 
         RowBox[{"radius", " ", 
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<S\>\"", "<>", 
              RowBox[{"ToString", "[", "l", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"n", "-", "1", "-", "subset"}]}], "}"}]}], "]"}]}]}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "convert", " ", "the", " ", "states", " ", "to", " ", "us", " ", "and", 
       " ", 
       RowBox[{"\[Theta]s", ".", " ", "Actually"}], " ", "I", " ", "use", " ", 
       RowBox[{"v", "'"}], "s", " ", "and", " ", 
       RowBox[{"w", "'"}], "s", " ", "defined", " ", "by", " ", "v"}], " ", 
      "=", " ", 
      RowBox[{"sqrt", 
       RowBox[{"(", "u", ")"}]}]}], ",", " ", 
     RowBox[{"w", " ", "=", " ", 
      RowBox[{"sqrt", 
       RowBox[{"(", 
        RowBox[{"1", "-", "u"}], ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"convertVariables", "[", 
     RowBox[{"states_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"xTable", ",", "yTable", ",", "\[Theta]Table", ",", "assump"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xTable", "=", 
        RowBox[{"generatexTable", "[", "n", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"yTable", "=", 
        RowBox[{"generateyTable", "[", "n", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Theta]Table", "=", 
        RowBox[{"generate\[Theta]Table", "[", "n", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"assump", "=", 
        RowBox[{"commonAssumptions", "[", "n", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "2"}], ",", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"states", "//.", 
               RowBox[{"{", "xTable", "}"}]}], "//.", 
              RowBox[{"{", "yTable", "}"}]}], "//.", 
             RowBox[{"{", "\[Theta]Table", "}"}]}], ",", 
            RowBox[{"Assumptions", "\[Rule]", "assump"}]}], "]"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"states", "//.", 
              RowBox[{"{", "xTable", "}"}]}], "//.", 
             RowBox[{"{", "yTable", "}"}]}], ",", 
            RowBox[{"Assumptions", "\[Rule]", "assump"}]}], "]"}], "//", 
          "Expand"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7299535922870913`*^9, 3.729953601127995*^9}, {
  3.734799776986454*^9, 3.73479978756604*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"5dde0b0b-b31f-4b31-b827-9f044c550f8b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Inner Product", "Subsection",
 CellChangeTimes->{{3.753136052895061*^9, 
  3.7531360572656384`*^9}},ExpressionUUID->"ec949f04-af7c-4a9d-bfd7-\
fa24d461f4f2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "refUpUm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "ref\[Theta]", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "ref\[Theta]Last", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"refUpUm", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"refUpUm", "[", 
     RowBox[{"a", ",", "b"}], "]"}], "=", 
    FractionBox[
     RowBox[{
      RowBox[{"Gamma", "[", 
       FractionBox[
        RowBox[{"1", "+", "a"}], "2"], "]"}], " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{"1", "+", 
        FractionBox["b", "2"]}], "]"}]}], 
     RowBox[{"2", " ", 
      RowBox[{"Gamma", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        RowBox[{"(", 
         RowBox[{"3", "+", "a", "+", "b"}], ")"}]}], "]"}]}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ref\[Theta]", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"ref\[Theta]", "[", 
      RowBox[{"a", ",", "b"}], "]"}], "=", 
     RowBox[{
      FractionBox["1", "\[Pi]"], 
      FractionBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "b"]}], ")"}], " ", 
        RowBox[{"Gamma", "[", 
         FractionBox[
          RowBox[{"1", "+", "a"}], "2"], "]"}], " ", 
        RowBox[{"Gamma", "[", 
         FractionBox[
          RowBox[{"1", "+", "b"}], "2"], "]"}]}], 
       RowBox[{"2", " ", 
        RowBox[{"Gamma", "[", 
         RowBox[{
          FractionBox["1", "2"], " ", 
          RowBox[{"(", 
           RowBox[{"2", "+", "a", "+", "b"}], ")"}]}], "]"}]}]]}]}]}], ";"}], 
  " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"this", " ", "factor", " ", "fo", " ", 
     FractionBox["1", "Pi"], " ", "is", " ", "to", " ", "deal", " ", "with", 
     " ", "constant", " ", "terms", " ", "in", " ", "the", " ", 
     RowBox[{"integrand", ".", " ", "To"}], " ", "compensate", " ", "for", 
     " ", "it"}], ",", " ", 
    RowBox[{
    "we", " ", "multiply", " ", "everything", " ", "by", " ", "a", " ", 
     "factor", " ", "of", " ", "\[Pi]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ref\[Theta]Last", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"ref\[Theta]Last", "[", 
      RowBox[{"a", ",", "b"}], "]"}], "=", 
     RowBox[{
      FractionBox["1", 
       RowBox[{"2", "\[Pi]"}]], 
      FractionBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "b"]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], 
           RowBox[{"a", "+", "b"}]]}], ")"}], " ", 
        RowBox[{"Gamma", "[", 
         FractionBox[
          RowBox[{"1", "+", "a"}], "2"], "]"}], " ", 
        RowBox[{"Gamma", "[", 
         FractionBox[
          RowBox[{"1", "+", "b"}], "2"], "]"}]}], 
       RowBox[{"2", " ", 
        RowBox[{"Gamma", "[", 
         RowBox[{
          FractionBox["1", "2"], " ", 
          RowBox[{"(", 
           RowBox[{"2", "+", "a", "+", "b"}], ")"}]}], "]"}]}]]}]}]}], ";"}], 
  " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"this", " ", "factor", " ", "fo", " ", 
     FractionBox["1", "Pi"], " ", "is", " ", "to", " ", "deal", " ", "with", 
     " ", "constant", " ", "terms", " ", "in", " ", "the", " ", 
     RowBox[{"integrand", ".", " ", "To"}], " ", "compensate", " ", "for", 
     " ", "it"}], ",", " ", 
    RowBox[{
    "we", " ", "multiply", " ", "everything", " ", "by", " ", "a", " ", 
     "factor", " ", "of", " ", "\[Pi]"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"innerNik", "[", 
    RowBox[{"n_", ",", "Fi_", ",", "Fj_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ups", ",", "ums", ",", "Sin\[Theta]s", ",", "Cos\[Theta]s", ",", 
       "vsandws", ",", "angles", ",", "integrand", ",", " ", "coeffRules", 
       ",", "coeffs", ",", "coeffpowers", ",", "powers", ",", "ref", ",", " ",
        "replaceRule", ",", "replaceRule\[Theta]"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Sin\[Theta]s", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<S\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Cos\[Theta]s", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<C\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ups", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<up\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ums", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<um\>\"", "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "the", " ", "1", " ", "and", " ", "2", " ", "particle", " ", "cases", 
         " ", "are", " ", "kind", " ", "of", " ", "dumb"}], ",", " ", 
        RowBox[{
        "so", " ", "we", " ", "just", " ", "handle", " ", "that", " ", 
         "separately"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"Pi", " ", "Fi", " ", "Fj"}], "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "2"}], ",", 
        RowBox[{
         RowBox[{"integrand", "=", 
          RowBox[{
           FractionBox["1", 
            RowBox[{
             RowBox[{"n", "!"}], 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"2", "Pi"}], ")"}], 
              RowBox[{
               RowBox[{"2", "n"}], "-", "3"}]], "2"}]], 
           RowBox[{"Product", "[", 
            RowBox[{
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"ups", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "4"], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"ums", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], 
               RowBox[{
                RowBox[{"5", "i"}], "-", "2"}]]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "Fi", " ", "Fj"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"integrand", "/.", 
                 RowBox[{"{", 
                  RowBox[{"yt1", "\[Rule]", "1"}], "}"}]}], ")"}], "+", 
               RowBox[{"(", 
                RowBox[{"integrand", "/.", 
                 RowBox[{"{", 
                  RowBox[{"yt1", "\[Rule]", 
                   RowBox[{"-", "1"}]}], "}"}]}], ")"}]}], ")"}], "//", 
             "Expand"}], ")"}], "//.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"ups", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"ums", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"ups", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               SuperscriptBox[
                RowBox[{"ums", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"for", " ", "n"}], ">", "2"}], ",", " ", 
        RowBox[{
        "we", " ", "compute", " ", "the", " ", "replacement", " ", "rules"}], 
        ",", " ", 
        RowBox[{"using", " ", "the", " ", "reference", " ", "integrals"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"replaceRule", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"x_", " ", 
              SuperscriptBox[
               RowBox[{"ups", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "k_"], 
              SuperscriptBox[
               RowBox[{"ums", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"x_", " ", 
              SuperscriptBox[
               RowBox[{"ups", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "k_"], 
              RowBox[{"ums", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"x_", " ", 
              RowBox[{"ups", "[", 
               RowBox[{"[", "i", "]"}], "]"}], 
              SuperscriptBox[
               RowBox[{"ums", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
              SuperscriptBox[
               RowBox[{"ums", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
              SuperscriptBox[
               RowBox[{"ups", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
              RowBox[{"ums", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
              RowBox[{"ups", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"refUpUm", "[", 
               RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "3"}], ",", " ", 
        RowBox[{
         RowBox[{"replaceRule\[Theta]", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
              SuperscriptBox[
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
              RowBox[{"Cos\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}]}], ":>", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              RowBox[{"Sin\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}], 
              SuperscriptBox[
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              RowBox[{"Sin\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}], 
              RowBox[{"Cos\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"x_", "/;", 
               RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
              RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              RowBox[{"Sin\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              RowBox[{"Cos\[Theta]s", "[", 
               RowBox[{"[", 
                RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
             "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
              SuperscriptBox[
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
             "\[RuleDelayed]", 
             RowBox[{"x", " ", 
              RowBox[{"ref\[Theta]Last", "[", 
               RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], ";"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", ">", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"replaceRule\[Theta]", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                   SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                   SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ":>", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                   SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                   SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                  RowBox[{"x", " ", 
                   RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2", ",", 
                 RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"x_", "/;", 
                  RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"integrand", "=", 
       RowBox[{"(*", 
        RowBox[{"N", "["}], "*)"}], 
       RowBox[{
        RowBox[{
         SuperscriptBox["Pi", 
          RowBox[{"n", "-", "3"}]], 
         RowBox[{"(", 
          RowBox[{"2", "Pi"}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           FractionBox["1", 
            RowBox[{
             RowBox[{"n", "!"}], 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"2", "Pi"}], ")"}], 
              RowBox[{
               RowBox[{"2", "n"}], "-", "3"}]], "2"}]], 
           RowBox[{"Product", "[", 
            RowBox[{
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"ups", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "4"], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"ums", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], 
               RowBox[{
                RowBox[{"5", "i"}], "-", "2"}]]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
           RowBox[{"Product", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"Sin\[Theta]s", "[", 
               RowBox[{"[", "i", "]"}], "]"}], 
              RowBox[{"i", "-", "1"}]], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], "Fi", " ", "Fj"}], 
          ")"}]}], " ", "//", "ExpandAll"}]}], 
      RowBox[{"(*", "]", "*)"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
       "replaceRule\[Theta]"}]}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.732280999266056*^9, 3.7322810282417097`*^9}, {
   3.7322811455384817`*^9, 3.73228117195232*^9}, {3.7322819481963987`*^9, 
   3.732281983291518*^9}, {3.732286354913602*^9, 3.732286428880287*^9}, {
   3.7322864775390463`*^9, 3.7322865299463787`*^9}, 3.732289809844051*^9, {
   3.732291957139008*^9, 3.732291958969956*^9}, {3.7322924242890387`*^9, 
   3.7322925054562883`*^9}, {3.7322934163197527`*^9, 3.732293419524097*^9}, {
   3.732293558857642*^9, 3.732293582948514*^9}, {3.7322940801391973`*^9, 
   3.7322940831083593`*^9}, {3.7322941740911283`*^9, 3.732294229384438*^9}, {
   3.733508002210473*^9, 3.7335080079871693`*^9}, {3.733590764421644*^9, 
   3.7335907732744493`*^9}, 3.733591694112335*^9, 3.733665725106167*^9, {
   3.73366724076226*^9, 3.733667264209908*^9}, {3.7336678608816147`*^9, 
   3.733667861792647*^9}, {3.733667925419241*^9, 3.733667931601037*^9}, {
   3.7336694541791162`*^9, 3.7336694545939837`*^9}, {3.733669552318809*^9, 
   3.7336695526406937`*^9}, {3.733669592152179*^9, 3.733669607239951*^9}, {
   3.7336696909381037`*^9, 3.7336696913802*^9}, {3.733669759277131*^9, 
   3.733669854214347*^9}, {3.7341032237057943`*^9, 3.734103278613984*^9}, {
   3.7341040729334927`*^9, 3.7341040742131863`*^9}, {3.73410419149804*^9, 
   3.734104195039235*^9}, {3.734799809309031*^9, 3.734799827317842*^9}, {
   3.736530783279838*^9, 3.736530787960659*^9}, {3.736530829017462*^9, 
   3.736530951284196*^9}, {3.7365314289204283`*^9, 3.736531479400796*^9}, {
   3.736532180706264*^9, 3.73653222003909*^9}, {3.736532411048708*^9, 
   3.736532460191012*^9}, {3.736532516162516*^9, 3.736532517538702*^9}, {
   3.736532820855979*^9, 3.736532887529312*^9}, {3.736532933717134*^9, 
   3.736532933922553*^9}, {3.736610235478407*^9, 3.73661023592408*^9}, {
   3.737217988090028*^9, 3.7372180184600563`*^9}, {3.739904477956938*^9, 
   3.739904481939468*^9}, {3.7399046631804943`*^9, 3.7399046684473352`*^9}, {
   3.739904714020955*^9, 3.739904717012044*^9}, {3.7401510861994143`*^9, 
   3.740151094522572*^9}, {3.740863132015771*^9, 3.740863135722801*^9}, {
   3.7410247992822037`*^9, 3.741024813896277*^9}, {3.7413732372615013`*^9, 
   3.74137324523525*^9}, {3.753136130193307*^9, 3.7531361306796417`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"d5a7316d-28b6-4f9b-bbfc-936ef7fb32c4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Mass Term", "Subsection",
 CellChangeTimes->{{3.753136079421468*^9, 
  3.753136080809183*^9}},ExpressionUUID->"2a83f87c-5091-47b6-9186-\
e61f4272cc4f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"the", " ", "mass", " ", "term", " ", "matrix", " ", 
    RowBox[{"element", ".", " ", "Note"}], " ", "that", " ", "it", " ", "is", 
    " ", "basically", " ", "just", " ", "the", " ", "inner", " ", "product", 
    " ", "but", " ", "with", " ", "a", " ", 
    RowBox[{"1", "/", 
     RowBox[{"u1", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "massNik", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"massNik", "[", 
      RowBox[{"n_", ",", "Fi_", ",", "Fj_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"massNik", "[", 
       RowBox[{"n", ",", "Fi", ",", "Fj"}], "]"}], "=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "ups", ",", "ums", ",", "Sin\[Theta]s", ",", "Cos\[Theta]s", ",", 
          "vsandws", ",", "angles", ",", "integrand", ",", " ", "coeffRules", 
          ",", "coeffs", ",", "coeffpowers", ",", "powers", ",", "ref", ",", 
          " ", "replaceRule", ",", "replaceRule\[Theta]"}], "}"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Sin\[Theta]s", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<S\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Cos\[Theta]s", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<C\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"ups", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<up\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ums", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"\"\<um\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"n", "\[Equal]", "1"}], ",", 
           RowBox[{"Return", "[", "1", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "the", " ", "2", " ", "particle", " ", "case", " ", "is", " ", 
            "kind", " ", "of", " ", "dumb"}], ",", " ", 
           RowBox[{
           "so", " ", "we", " ", "just", " ", "handle", " ", "that", " ", 
            "separately"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"n", "\[Equal]", "2"}], ",", 
           RowBox[{
            RowBox[{"integrand", "=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}], "!"}], 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}], 
                 RowBox[{
                  RowBox[{"2", "n"}], "-", "3"}]], "2"}]], 
              RowBox[{"Product", "[", 
               RowBox[{
                RowBox[{
                 FractionBox["1", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "-", "1"}], "]"}], "]"}], "2"]], 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "4"], 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                  RowBox[{
                   RowBox[{"5", "i"}], "-", "2"}]]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "Fi", " ", 
              "Fj"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Return", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"integrand", "/.", 
                    RowBox[{"{", 
                    RowBox[{"yt1", "\[Rule]", "1"}], "}"}]}], ")"}], "+", 
                  RowBox[{"(", 
                   RowBox[{"integrand", "/.", 
                    RowBox[{"{", 
                    RowBox[{"yt1", "\[Rule]", 
                    RowBox[{"-", "1"}]}], "}"}]}], ")"}]}], ")"}], "//", 
                "Expand"}], ")"}], "//.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"for", " ", "n"}], ">", "2"}], ",", " ", 
           RowBox[{
           "we", " ", "compute", " ", "the", " ", "replacement", " ", 
            "rules"}], ",", " ", 
           RowBox[{
           "using", " ", "the", " ", "reference", " ", "integrals"}]}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"replaceRule", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"n", "\[Equal]", "3"}], ",", " ", 
           RowBox[{
            RowBox[{"replaceRule\[Theta]", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"x_", "/;", 
                  RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
                "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
                "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], ";"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"n", ">", "3"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"replaceRule\[Theta]", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2", ",", 
                    RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
            ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"integrand", "=", 
          RowBox[{
           RowBox[{
            SuperscriptBox["Pi", 
             RowBox[{"n", "-", "2"}]], 
            RowBox[{"(", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}], "!"}], 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}], 
                 RowBox[{
                  RowBox[{"2", "n"}], "-", "3"}]]}]], 
              RowBox[{"Product", "[", 
               RowBox[{
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "4"], 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                  RowBox[{
                   RowBox[{"5", "i"}], "-", "2"}]]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
              FractionBox["1", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "-", "1"}], "]"}], "]"}], ")"}], "2"]], 
              RowBox[{"Product", "[", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"i", "-", "1"}]], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], "Fi", " ", 
              "Fj"}], ")"}]}], " ", "//", "ExpandAll"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "this", " ", "extra", " ", "factor", " ", "of", " ", "Pi", " ", 
            "is", " ", "there", " ", "because", " ", "of", " ", "constant", 
            " ", 
            RowBox[{"terms", ".", " ", "Note"}], " ", "that", " ", "there", 
            " ", "are", " ", "no", " ", 
            RowBox[{"2", "^", "powers"}]}], ",", " ", 
           RowBox[{
            RowBox[{
            "because", " ", "we", " ", "switched", " ", "to", " ", 
             "integrating", " ", "over", " ", "u"}], "+", 
            RowBox[{".", " ", "Also"}]}], ",", " ", 
           RowBox[{
            RowBox[{"the", " ", "theta", " ", "integral", " ", 
             RowBox[{"from", " ", "[", 
              RowBox[{"0", ",", 
               RowBox[{"2", "Pi"}]}], "]"}]}], " ", "=", " ", 
            RowBox[{"2", " ", "*", " ", "the", " ", "one", " ", 
             RowBox[{
              RowBox[{"from", " ", "[", 
               RowBox[{"0", ",", "Pi"}], "]"}], ".", " ", "So"}], " ", "this",
              " ", "kills", " ", "those", " ", "factors", " ", "of", " ", 
             "2."}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
          "replaceRule\[Theta]"}]}]}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"{", 
         RowBox[{"integrand", ",", 
          RowBox[{"Flatten", "@", "replaceRule"}], ",", 
          RowBox[{"Flatten", "@", "replaceRule\[Theta]"}], ",", 
          RowBox[{
           RowBox[{"integrand", "//.", "replaceRule"}], "/.", 
           "replaceRule\[Theta]"}]}], "}"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"And", " ", "discretized", " ", "by", " ", 
     RowBox[{"\[Mu]", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mass\[Mu]", "[", 
      RowBox[{"n_", ",", "k_", ",", "kp_", ",", "Fi_", ",", "Fj_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"KroneckerDelta", "[", 
       RowBox[{"k", ",", "kp"}], "]"}], 
      RowBox[{"mass", "[", 
       RowBox[{"n", ",", "Fi", ",", "Fj"}], "]"}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.730138687374668*^9, 3.730138774781453*^9}, {
   3.730138819134192*^9, 3.730138829077264*^9}, {3.73013898871204*^9, 
   3.730138992320524*^9}, {3.730818738399444*^9, 3.730818742884235*^9}, {
   3.730818838946048*^9, 3.7308188440408373`*^9}, {3.732294593633684*^9, 
   3.732294629027946*^9}, {3.7322948008290787`*^9, 3.7322948322445707`*^9}, {
   3.7322950876331053`*^9, 3.732295133232245*^9}, {3.732295187508329*^9, 
   3.7322951926047497`*^9}, {3.732295378233118*^9, 3.7322953904142942`*^9}, {
   3.733508200067848*^9, 3.733508205068379*^9}, {3.733670006913404*^9, 
   3.733670007651533*^9}, {3.73420352354503*^9, 3.734203552837463*^9}, {
   3.7342035907122593`*^9, 3.734203592425853*^9}, {3.734799842551549*^9, 
   3.7347999047240973`*^9}, {3.736530985212278*^9, 3.7365310209106417`*^9}, 
   3.7365315100078506`*^9, 3.7365315410856752`*^9, {3.736532955829164*^9, 
   3.736532957543247*^9}, {3.737656258259811*^9, 3.7376562991955853`*^9}, {
   3.753135970520842*^9, 3.753135974140781*^9}, {3.753136144219883*^9, 
   3.753136150009019*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"95b65eff-9a51-417a-8452-a4b0989dbec5"]
}, Closed]],

Cell[CellGroupData[{

Cell["N\[Rule]N", "Subsection",
 CellChangeTimes->{{3.759254511732226*^9, 
  3.759254519091785*^9}},ExpressionUUID->"ea567448-48d2-47f2-88a4-\
3f9b2d6fb8f2"],

Cell["\<\
convertVariablesNtoN[...] does the change of variables for the N-to-N matrix \
elements. In particular it returns the product (F_+ + \
F_-)(F\[CloseCurlyQuote]_+ + F\[CloseCurlyQuote]_-). state1 and state2 refer \
to F and F\[CloseCurlyQuote].\
\>", "Text",
 CellChangeTimes->{{3.732295685050747*^9, 3.732295740357399*^9}, {
  3.732303724624655*^9, 
  3.732303729334841*^9}},ExpressionUUID->"b767e2ff-0572-425e-9302-\
18e27aa00ce0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "convertVariablesNtoN", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"convertVariablesNtoN", "[", 
   RowBox[{"state1_", ",", "state2_", ",", "n_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"convertVariablesNtoN", "[", 
    RowBox[{"state1", ",", "state2", ",", "n"}], "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xTable", ",", "xTableP", ",", "yTable", ",", "yTableP", ",", 
       "\[Theta]Table", ",", "setPrimedtoUnPrimed", ",", "setyTilde1", ",", 
       "setyTildeP1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xTable", "=", 
       RowBox[{"generatexTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xTableP", "=", 
       RowBox[{"generatexTable", "[", 
        RowBox[{"n", ",", "True"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"yTable", "=", 
       RowBox[{"generateyTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yTableP", "=", 
       RowBox[{"generateyTable", "[", 
        RowBox[{"n", ",", "True"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]Table", "=", 
       RowBox[{"generate\[Theta]Table", "[", 
        RowBox[{"n", ",", "2", ",", "r"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"setPrimedtoUnPrimed", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<'\>\""}], 
              "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<'\>\""}], 
              "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<yt\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<'\>\""}], 
              "]"}], "\[Rule]", 
             RowBox[{
              FractionBox["\[Mu]", "\[Mu]p"], 
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<yt\>\"", "<>", 
                RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}]}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"setyTilde1", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt1\>\"", "]"}], "\[Rule]", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"1", "-", 
            SuperscriptBox["r", "2"]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt1\>\"", "]"}], "\[Rule]", 
          RowBox[{"-", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"1", "-", 
             SuperscriptBox["r", "2"]}], "]"}]}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"setyTildeP1", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<yt1\>\"", "<>", "\"\<'\>\""}], "]"}], "\[Rule]", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"1", "-", 
            RowBox[{
             FractionBox[
              SuperscriptBox["\[Mu]", "2"], 
              SuperscriptBox["\[Mu]p", "2"]], 
             SuperscriptBox["r", "2"]}]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<yt1\>\"", "<>", "\"\<'\>\""}], "]"}], "\[Rule]", 
          RowBox[{"-", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"1", "-", 
             RowBox[{
              FractionBox[
               SuperscriptBox["\[Mu]", "2"], 
               SuperscriptBox["\[Mu]p", "2"]], 
              SuperscriptBox["r", "2"]}]}], "]"}]}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"setyTilde1", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", "\"\<yt1\>\"", "]"}], "\[Rule]", 
             "1"}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", "\"\<yt1\>\"", "]"}], "\[Rule]", 
             RowBox[{"-", "1"}]}]}], "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"setyTildeP1", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<yt1\>\"", "<>", "\"\<'\>\""}], "]"}], "\[Rule]", 
             "1"}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<yt1\>\"", "<>", "\"\<'\>\""}], "]"}], "\[Rule]", 
             RowBox[{"-", "1"}]}]}], "}"}]}], ";", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"state1", "//.", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTable", ",", "yTable", ",", 
                    RowBox[{"setyTilde1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ")"}], 
                 "+", 
                 RowBox[{"(", 
                  RowBox[{"state1", "//.", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTable", ",", "yTable", ",", 
                    RowBox[{"setyTilde1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ")"}]}],
                 ")"}], 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"state2", "//.", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTableP", ",", "yTableP", ",", 
                    RowBox[{"setyTildeP1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ")"}], 
                 "+", 
                 RowBox[{"(", 
                  RowBox[{"state2", "//.", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTableP", ",", "yTableP", ",", 
                    RowBox[{"setyTildeP1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ")"}]}],
                 ")"}]}], ")"}], "//.", "setPrimedtoUnPrimed"}], ")"}], " ", "//",
            "Expand"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"state1", "//.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"xTable", ",", "yTable", ",", 
                    RowBox[{"setyTilde1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ")"}], 
               "+", 
               RowBox[{"(", 
                RowBox[{"state1", "//.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"xTable", ",", "yTable", ",", 
                    RowBox[{"setyTilde1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ")"}]}],
               ")"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"state2", "//.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"xTableP", ",", "yTableP", ",", 
                    RowBox[{"setyTildeP1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ")"}], 
               "+", 
               RowBox[{"(", 
                RowBox[{"state2", "//.", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"xTableP", ",", "yTableP", ",", 
                    RowBox[{"setyTildeP1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], ")"}]}],
               ")"}]}], ")"}], "//.", "setPrimedtoUnPrimed"}], ")"}], "//.", 
         "\[Theta]Table"}], " ", "//", "Expand"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.732295628970669*^9, 3.732295629644271*^9}, {
   3.732295679873678*^9, 3.732295682663341*^9}, {3.732299200739017*^9, 
   3.732299285491095*^9}, {3.732300823398486*^9, 3.732300886108374*^9}, {
   3.7323011277678022`*^9, 3.732301177915501*^9}, {3.732301224059596*^9, 
   3.732301284151853*^9}, {3.732301326170244*^9, 3.732301497700275*^9}, {
   3.732301589253594*^9, 3.732301590606831*^9}, {3.732301931164215*^9, 
   3.732301955157157*^9}, {3.732301994458394*^9, 3.732302049514152*^9}, {
   3.732303461666658*^9, 3.732303515811612*^9}, {3.732303580978135*^9, 
   3.732303585274418*^9}, {3.732303662399221*^9, 3.7323037106196537`*^9}, {
   3.732374325676305*^9, 3.73237451747447*^9}, {3.732375020016006*^9, 
   3.732375026462543*^9}, 3.73237511965763*^9, {3.732375164090925*^9, 
   3.7323751705613527`*^9}, {3.732389415599842*^9, 3.732389496728368*^9}, {
   3.732389780771347*^9, 3.732389874883027*^9}, {3.732389905172613*^9, 
   3.7323899080044737`*^9}, {3.7323962356784077`*^9, 3.732396289759306*^9}, {
   3.7324672475549707`*^9, 3.732467339605816*^9}, {3.732468027823539*^9, 
   3.732468043430237*^9}, {3.7324692018264017`*^9, 3.732469207320732*^9}, {
   3.732469282800639*^9, 3.732469330113138*^9}, {3.732471918536046*^9, 
   3.732471934045784*^9}, {3.73350827759319*^9, 3.7335083071208*^9}, {
   3.7335084427640047`*^9, 3.733508459787216*^9}, {3.733509012177702*^9, 
   3.733509031011614*^9}, {3.733509843802367*^9, 3.7335098815166407`*^9}, {
   3.733512251560656*^9, 3.733512266273658*^9}, {3.7335122965056868`*^9, 
   3.7335123247137833`*^9}, {3.733513538462538*^9, 3.733513565838587*^9}, {
   3.733513808314374*^9, 3.733513843242112*^9}, {3.7335141093325567`*^9, 
   3.7335142424473257`*^9}, {3.733514279840988*^9, 3.7335143231697817`*^9}, {
   3.733514355448926*^9, 3.733514424991356*^9}, 3.733581567712491*^9, {
   3.733582374773058*^9, 3.733582436310239*^9}, {3.7335825616465607`*^9, 
   3.733582589622759*^9}, {3.733586329022789*^9, 3.73358636617205*^9}, {
   3.733586418917562*^9, 3.733586466797999*^9}, {3.7335868605500307`*^9, 
   3.7335868706133337`*^9}, {3.733587146007759*^9, 3.73358716226864*^9}, {
   3.733756366318287*^9, 3.733756370842823*^9}, {3.734114729537139*^9, 
   3.734114731121499*^9}, {3.734117491484277*^9, 3.734117494930101*^9}, {
   3.734117992479383*^9, 3.7341180146326237`*^9}, {3.734118055434195*^9, 
   3.734118058168867*^9}, {3.734118149701538*^9, 3.7341182612868147`*^9}, {
   3.734118306778441*^9, 3.734118307041533*^9}, 3.734450875087978*^9, {
   3.734453120275141*^9, 3.7344531276890087`*^9}, 3.7344534863594093`*^9, {
   3.734453774759659*^9, 3.734453792456201*^9}, {3.734453849658598*^9, 
   3.734453851271978*^9}, {3.734453983384192*^9, 3.734454013083612*^9}, {
   3.734456953138372*^9, 3.734456955321806*^9}, 3.7344572229705667`*^9, {
   3.734799948926518*^9, 3.73479995924417*^9}, {3.735501293833832*^9, 
   3.735501320602479*^9}, {3.73651568313151*^9, 3.736515690450263*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"3608d25e-e980-4e35-b2d7-987d7bee4a43"],

Cell["\<\
define the r reference integral. The ellipticK is for constant terms.\
\>", "Text",
 CellChangeTimes->{{3.732301799412527*^9, 3.732301802114463*^9}, {
  3.732302543301283*^9, 3.732302556945141*^9}, {3.732375469004959*^9, 
  3.732375475493904*^9}, {3.732375522305238*^9, 3.732375529167039*^9}, {
  3.734799973107877*^9, 
  3.734799973987018*^9}},ExpressionUUID->"6d34ac79-9b36-4ace-aa52-\
11e2da8e173f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "refR", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"refR", "[", "a_", "]"}], ":=", 
   RowBox[{
    RowBox[{"refR", "[", "a", "]"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"EllipticF", "[", 
       RowBox[{
        RowBox[{"ArcSin", "[", 
         RowBox[{"Min", "[", 
          RowBox[{"1", ",", 
           FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "]"}], ",", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}], "]"}]], 
     RowBox[{"(", 
      RowBox[{
       FractionBox["1", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", "a"}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "1"}], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}], ")"}]}]], 
       SuperscriptBox[
        RowBox[{"Min", "[", 
         RowBox[{"1", ",", 
          FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], 
        RowBox[{"1", "+", "a"}]], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"], " ", 
          RowBox[{"AppellF1", "[", 
           RowBox[{
            FractionBox[
             RowBox[{"1", "+", "a"}], "2"], ",", 
            RowBox[{"-", 
             FractionBox["1", "2"]}], ",", 
            FractionBox["1", "2"], ",", 
            FractionBox[
             RowBox[{"3", "+", "a"}], "2"], ",", 
            SuperscriptBox[
             RowBox[{"Min", "[", 
              RowBox[{"1", ",", 
               FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], ",", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"Min", "[", 
               RowBox[{"1", ",", 
                FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], " ", 
             SuperscriptBox[
              RowBox[{"(", 
               FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}]}], "]"}]}], "-", 
         
         RowBox[{"AppellF1", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"1", "+", "a"}], "2"], ",", 
           FractionBox["1", "2"], ",", 
           RowBox[{"-", 
            FractionBox["1", "2"]}], ",", 
           FractionBox[
            RowBox[{"3", "+", "a"}], "2"], ",", 
           SuperscriptBox[
            RowBox[{"Min", "[", 
             RowBox[{"1", ",", 
              FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"Min", "[", 
              RowBox[{"1", ",", 
               FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], " ", 
            SuperscriptBox[
             RowBox[{"(", 
              FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}]}], "]"}]}], 
        ")"}]}], ")"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.732301817977462*^9, 3.732301832627726*^9}, {
  3.7323023569891148`*^9, 3.732302376293212*^9}, {3.7323025656941433`*^9, 
  3.732302566810082*^9}, {3.732375457600265*^9, 3.73237546589526*^9}, {
  3.7336830187709208`*^9, 3.733683125241722*^9}, {3.734123052154319*^9, 
  3.7341230740495987`*^9}, {3.7347999803001003`*^9, 3.734799981859391*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"45f23581-d17e-447d-b417-4d4cf611ca47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "refR2", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"refR2", "[", "a_", "]"}], ":=", 
   RowBox[{
    RowBox[{"refR2", "[", "a", "]"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", "a"}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         FractionBox[
          SuperscriptBox["\[Mu]", "2"], 
          SuperscriptBox["\[Mu]p", "2"]]}], ")"}]}]], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        FractionBox[
         RowBox[{
          SuperscriptBox["\[Mu]", "2"], " ", 
          RowBox[{"AppellF1", "[", 
           RowBox[{
            FractionBox[
             RowBox[{"1", "+", "a"}], "2"], ",", 
            RowBox[{"-", 
             FractionBox["1", "2"]}], ",", 
            FractionBox["1", "2"], ",", 
            FractionBox[
             RowBox[{"3", "+", "a"}], "2"], ",", 
            SuperscriptBox[
             RowBox[{"Min", "[", 
              RowBox[{"1", ",", 
               FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], ",", 
            FractionBox[
             RowBox[{
              SuperscriptBox["\[Mu]", "2"], " ", 
              SuperscriptBox[
               RowBox[{"Min", "[", 
                RowBox[{"1", ",", 
                 FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"]}], 
             SuperscriptBox["\[Mu]p", "2"]]}], "]"}]}], 
         SuperscriptBox["\[Mu]p", "2"]], "-", 
        RowBox[{"AppellF1", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"1", "+", "a"}], "2"], ",", 
          FractionBox["1", "2"], ",", 
          RowBox[{"-", 
           FractionBox["1", "2"]}], ",", 
          FractionBox[
           RowBox[{"3", "+", "a"}], "2"], ",", 
          SuperscriptBox[
           RowBox[{"Min", "[", 
            RowBox[{"1", ",", 
             FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"], ",", 
          FractionBox[
           RowBox[{
            SuperscriptBox["\[Mu]", "2"], " ", 
            SuperscriptBox[
             RowBox[{"Min", "[", 
              RowBox[{"1", ",", 
               FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "2"]}], 
           SuperscriptBox["\[Mu]p", "2"]]}], "]"}]}], ")"}], " ", 
      SuperscriptBox[
       RowBox[{"Min", "[", 
        RowBox[{"1", ",", 
         FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], 
       RowBox[{"1", "+", "a"}]]}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7354224516849737`*^9, 3.735422462663372*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"456eb8e9-7ae6-4d87-b3ee-034b85224455"],

Cell["\<\
now the matrix element itself. The second argument is (F_+ + F_-)(F\
\[CloseCurlyQuote]_+ + F\[CloseCurlyQuote]_-), which is obtained by running \
convertVariablesNtoN[..]\
\>", "Text",
 CellChangeTimes->{{3.732302462458673*^9, 3.7323024667206573`*^9}, {
  3.732302947088767*^9, 3.732302965912002*^9}, {3.7325495484733877`*^9, 
  3.7325495503404303`*^9}},ExpressionUUID->"cc663e28-155e-47cb-a8fb-\
00fbd88a1325"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "NtoN", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NtoN", "[", 
    RowBox[{"n_", ",", "productFiFj_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"NtoN", "[", 
     RowBox[{"n", ",", "productFiFj"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ups", ",", "ums", ",", "uPrimes", ",", "Sin\[Theta]s", ",", 
        "Cos\[Theta]s", ",", "vsandws", ",", "angles", ",", "integrand", ",", 
        " ", "coeffRules", ",", "coeffs", ",", "coeffpowers", ",", "powers", 
        ",", "ref", ",", " ", "replaceRule", ",", "replaceRule2", ",", 
        "replaceRule\[Theta]", ",", "replaceRuleR", ",", "replaceRuleR2"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ups", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<up\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ums", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<um\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"uPrimes", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"up1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}], ",", 
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"um1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "we", " ", "compute", " ", "the", " ", "replacement", " ", "rules"}],
          ",", " ", 
         RowBox[{"using", " ", "the", " ", "reference", " ", "integrals"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"replaceRule", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "1"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"replaceRule2", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"replaceRuleR", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
            SuperscriptBox["r", "k_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR", "[", "k", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], "r"}], 
           "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR", "[", "1", "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"replaceRuleR2", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
            SuperscriptBox["r", "k_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR2", "[", "k", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], "r"}], 
           "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR2", "[", "1", "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "3"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sin\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<S\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Cos\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<C\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "\[Equal]", "4"}], ",", 
            RowBox[{"replaceRule\[Theta]", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"x_", "/;", 
                  RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}]}], "]"}], ";",
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">", "4"}], ",", 
            RowBox[{
             RowBox[{"replaceRule\[Theta]", "=", 
              RowBox[{"Flatten", "@", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "2", ",", 
                    RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
             ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "2", " ", "and", " ", "3", " ", "particle", " ", "cases",
           " ", "are", " ", "simpler"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "just", " ", "handle", " ", "that", " ", 
          "separately"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "2"}], ",", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "2"}], ")"}], "!"}], 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "n"}], "+", "2"}]], 
              SuperscriptBox["Pi", 
               RowBox[{
                RowBox[{"2", "n"}], "-", "2"}]]}]], 
            SuperscriptBox[
             RowBox[{"ups", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"ums", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"uPrimes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "productFiFj"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"integrand", "//", "Expand"}], ")"}], "//.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"x_", " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"x_", " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"x_", " ", 
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}]}], ")"}], "//.",
             "replaceRule"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "3"}], ",", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"EllipticF", "[", 
              RowBox[{
               RowBox[{"ArcSin", "[", 
                RowBox[{"Min", "[", 
                 RowBox[{"1", ",", 
                  FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "]"}], ",", 
               SuperscriptBox[
                RowBox[{"(", 
                 FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "-", "2"}], ")"}], "!"}], 
                 SuperscriptBox["2", 
                  RowBox[{
                   RowBox[{"2", "n"}], "+", "2"}]], 
                 SuperscriptBox["Pi", 
                  RowBox[{
                   RowBox[{"2", "n"}], "-", "2"}]]}]], 
               RowBox[{"ups", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"ums", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "2"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ups", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ums", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                   RowBox[{
                    RowBox[{"5", "i"}], "-", "3"}]]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "2", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "productFiFj"}],
               ")"}]}], " ", "//", "ExpandAll"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Return", "[", "integrand", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
                 "replaceRuleR"}], ")"}], "//.", "replaceRule2"}], " ", "//", 
              "Cancel"}], "//", "Expand"}], ")"}], "]"}], ";"}]}], "]"}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"integrand", "=", 
        RowBox[{
         RowBox[{
          SuperscriptBox["Pi", 
           RowBox[{"n", "-", "4"}]], 
          RowBox[{"(", 
           RowBox[{"2", "Pi"}], ")"}], 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "2"}], ")"}], "!"}], 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "n"}], "+", "2"}]], 
              SuperscriptBox["Pi", 
               RowBox[{
                RowBox[{"2", "n"}], "-", "2"}]]}]], 
            RowBox[{"ups", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"ums", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"uPrimes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                RowBox[{
                 RowBox[{"5", "i"}], "-", "3"}]]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "2", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{"ups", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            SuperscriptBox["r", 
             RowBox[{"n", "-", "3"}]], 
            RowBox[{"Product", "[", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", "i", "]"}], "]"}], 
               RowBox[{"i", "-", "1"}]], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}], "productFiFj"}], 
           ")"}]}], " ", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "this", " ", "extra", " ", "factor", " ", "of", " ", "Pi", " ", 
             "is", " ", "there", " ", "because", " ", "of", " ", "constant", 
             " ", 
             RowBox[{"terms", ".", " ", "Note"}], " ", "that", " ", 
             "choosing", " ", "to", " ", "integrate", " ", "over", " ", "u"}],
             "+", " ", 
            RowBox[{
            "gives", " ", "us", " ", "the", " ", "factors", " ", "of", " ", 
             RowBox[{"2", "^", 
              RowBox[{"(", "..", ")"}]}], " ", "as", " ", "well", " ", "as", 
             " ", "the", " ", "product", " ", "u1"}], "+", " ", "u2", "+"}], 
           " ", "..."}], " ", "un"}], "-", "1", "+", " ", 
         RowBox[{
          RowBox[{"u", "'"}], "1"}], "+", "."}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
                "replaceRule\[Theta]"}], ")"}], "//.", "replaceRuleR2"}], 
             ")"}], "//.", "replaceRule2"}], ")"}], "//", "Cancel"}], "//", 
         "Expand"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7323023908639727`*^9, 3.732302414065888*^9}, 
   3.732302459312894*^9, {3.7323024896335487`*^9, 3.732302537149873*^9}, {
   3.73230276683427*^9, 3.732302794529438*^9}, {3.7323028614127502`*^9, 
   3.732302905356347*^9}, {3.732303754027483*^9, 3.732303764179853*^9}, {
   3.732375507005609*^9, 3.732375515596902*^9}, 3.7324653141771917`*^9, {
   3.7324667362803926`*^9, 3.732466798508753*^9}, {3.732468058628413*^9, 
   3.732468218783828*^9}, {3.732468258014163*^9, 3.732468481734124*^9}, {
   3.732469061960368*^9, 3.732469084885483*^9}, {3.732469131194077*^9, 
   3.732469154302677*^9}, {3.732469862949312*^9, 3.732469913214756*^9}, {
   3.7324699705843983`*^9, 3.732470044841889*^9}, {3.732471511983301*^9, 
   3.7324715190764914`*^9}, 3.7324730676106253`*^9, {3.7324784316345787`*^9, 
   3.732478565771891*^9}, 3.732478665386045*^9, {3.732549874511047*^9, 
   3.732549969048038*^9}, {3.733587212600893*^9, 3.733587232359427*^9}, {
   3.733588377346189*^9, 3.733588379657856*^9}, {3.733588478329451*^9, 
   3.733588481009426*^9}, {3.733588541332136*^9, 3.7335885450017643`*^9}, {
   3.7335887958993177`*^9, 3.733588799355649*^9}, {3.733588917827553*^9, 
   3.733588920499796*^9}, {3.7335894928754*^9, 3.733589510810769*^9}, {
   3.733589656580002*^9, 3.733589662666374*^9}, {3.7335897395495787`*^9, 
   3.733589787078291*^9}, {3.733590370938265*^9, 3.733590379025333*^9}, {
   3.733591111596985*^9, 3.733591126801127*^9}, {3.7335914326637363`*^9, 
   3.733591499182048*^9}, {3.733591538226754*^9, 3.733591560116571*^9}, {
   3.733591606209572*^9, 3.73359164376775*^9}, 3.733591965172163*^9, {
   3.7336173860965*^9, 3.733617398971203*^9}, {3.733617449942378*^9, 
   3.733617542482727*^9}, 3.7336187379916687`*^9, {3.733670045858536*^9, 
   3.733670046648615*^9}, 3.733680350189622*^9, 3.733680580442629*^9, {
   3.7336806477776823`*^9, 3.7336806482017937`*^9}, {3.734114809162099*^9, 
   3.734114835543112*^9}, {3.734122017012063*^9, 3.734122178003738*^9}, {
   3.734122234862664*^9, 3.7341222658663588`*^9}, {3.7341223010795383`*^9, 
   3.7341223850962467`*^9}, {3.734123085666217*^9, 3.7341230925067387`*^9}, {
   3.73445837879056*^9, 3.734458381792285*^9}, 3.734799241742981*^9, {
   3.7347993506627274`*^9, 3.734799353996479*^9}, {3.734799993442037*^9, 
   3.734799997385627*^9}, {3.734800057966155*^9, 3.7348000595858507`*^9}, {
   3.734800110290793*^9, 3.734800114190524*^9}, 3.735400746002378*^9, {
   3.735405462870158*^9, 3.735405464661913*^9}, 3.735419121435226*^9, {
   3.7354191590629587`*^9, 3.735419161716424*^9}, {3.735421099256482*^9, 
   3.7354211267216787`*^9}, {3.735423403857465*^9, 3.735423440144746*^9}, {
   3.7354939760219507`*^9, 3.735493977228158*^9}, {3.735501474106175*^9, 
   3.7355014816912117`*^9}, 3.735501534353537*^9, {3.735501575643207*^9, 
   3.7355015898024397`*^9}, {3.736529574142597*^9, 3.73652958350886*^9}, {
   3.736529776266017*^9, 3.7365297983119793`*^9}, 3.736529875864389*^9, {
   3.736531081598819*^9, 3.736531392308278*^9}, {3.73653160520408*^9, 
   3.736531620940488*^9}, {3.736533010161442*^9, 3.736533116011236*^9}, {
   3.736535570501051*^9, 3.736535572033699*^9}, {3.73653951732272*^9, 
   3.736539519697603*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"47d6b581-d7c3-409a-b321-ec7c8a9df0de"],

Cell["\<\
MODIFIED VERSION of NtoN to handle non-dirichlet wavefunctions. Just add two \
entries to replaceRule\
\>", "Text",
 CellChangeTimes->{{3.759694622568306*^9, 3.759694639606165*^9}, {
  3.759695033656397*^9, 
  3.759695045786211*^9}},ExpressionUUID->"233f02b0-b886-410e-9df7-\
f25c69d132a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "NtoNF", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NtoNF", "[", 
    RowBox[{"n_", ",", "productFiFj_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"NtoNF", "[", 
     RowBox[{"n", ",", "productFiFj"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ups", ",", "ums", ",", "uPrimes", ",", "Sin\[Theta]s", ",", 
        "Cos\[Theta]s", ",", "vsandws", ",", "angles", ",", "integrand", ",", 
        " ", "coeffRules", ",", "coeffs", ",", "coeffpowers", ",", "powers", 
        ",", "ref", ",", " ", "replaceRule", ",", "replaceRule2", ",", 
        "replaceRule\[Theta]", ",", "replaceRuleR", ",", "replaceRuleR2"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ups", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<up\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ums", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<um\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"uPrimes", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"up1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}], ",", 
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"um1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "we", " ", "compute", " ", "the", " ", "replacement", " ", "rules"}],
          ",", " ", 
         RowBox[{"using", " ", "the", " ", "reference", " ", "integrals"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"replaceRule", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"replaceRule2", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "l"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"replaceRuleR", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
            SuperscriptBox["r", "k_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR", "[", "k", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], "r"}], 
           "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR", "[", "1", "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"replaceRuleR2", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
            SuperscriptBox["r", "k_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR2", "[", "k", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], "r"}], 
           "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"refR2", "[", "1", "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "3"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sin\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<S\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Cos\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<C\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "\[Equal]", "4"}], ",", 
            RowBox[{"replaceRule\[Theta]", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"x_", "/;", 
                  RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Sin\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 RowBox[{"Cos\[Theta]s", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                 SuperscriptBox[
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"ref\[Theta]Last", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}]}], "]"}], ";",
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">", "4"}], ",", 
            RowBox[{
             RowBox[{"replaceRule\[Theta]", "=", 
              RowBox[{"Flatten", "@", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "l"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "2", ",", 
                    RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                    RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]Last", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
             ";"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "2", " ", "and", " ", "3", " ", "particle", " ", "cases",
           " ", "are", " ", "simpler"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "just", " ", "handle", " ", "that", " ", 
          "separately"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "2"}], ",", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "2"}], ")"}], "!"}], 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "n"}], "+", "2"}]], 
              SuperscriptBox["Pi", 
               RowBox[{
                RowBox[{"2", "n"}], "-", "2"}]]}]], 
            SuperscriptBox[
             RowBox[{"ups", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"ums", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"uPrimes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "productFiFj"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"integrand", "//", "Expand"}], ")"}], "//.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"x_", " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"x_", " ", 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"x_", " ", 
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"ums", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"ups", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"refUpUm", "[", 
                   RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}]}], ")"}], "//.",
             "replaceRule"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "3"}], ",", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"EllipticF", "[", 
              RowBox[{
               RowBox[{"ArcSin", "[", 
                RowBox[{"Min", "[", 
                 RowBox[{"1", ",", 
                  FractionBox["\[Mu]p", "\[Mu]"]}], "]"}], "]"}], ",", 
               SuperscriptBox[
                RowBox[{"(", 
                 FractionBox["\[Mu]", "\[Mu]p"], ")"}], "2"]}], "]"}], 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "-", "2"}], ")"}], "!"}], 
                 SuperscriptBox["2", 
                  RowBox[{
                   RowBox[{"2", "n"}], "+", "2"}]], 
                 SuperscriptBox["Pi", 
                  RowBox[{
                   RowBox[{"2", "n"}], "-", "2"}]]}]], 
               RowBox[{"ups", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"ums", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "2"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ups", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ums", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                   RowBox[{
                    RowBox[{"5", "i"}], "-", "3"}]]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "2", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "productFiFj"}],
               ")"}]}], " ", "//", "ExpandAll"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Return", "[", "integrand", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
                 "replaceRuleR"}], ")"}], "//.", "replaceRule2"}], " ", "//", 
              "Cancel"}], "//", "Expand"}], ")"}], "]"}], ";"}]}], "]"}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"integrand", "=", 
        RowBox[{
         RowBox[{
          SuperscriptBox["Pi", 
           RowBox[{"n", "-", "4"}]], 
          RowBox[{"(", 
           RowBox[{"2", "Pi"}], ")"}], 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "2"}], ")"}], "!"}], 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "n"}], "+", "2"}]], 
              SuperscriptBox["Pi", 
               RowBox[{
                RowBox[{"2", "n"}], "-", "2"}]]}]], 
            RowBox[{"ups", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"ums", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"uPrimes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "2"], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                RowBox[{
                 RowBox[{"5", "i"}], "-", "3"}]]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "2", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{"ups", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            SuperscriptBox["r", 
             RowBox[{"n", "-", "3"}]], 
            RowBox[{"Product", "[", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", "i", "]"}], "]"}], 
               RowBox[{"i", "-", "1"}]], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "3"}]}], "}"}]}], "]"}], "productFiFj"}], 
           ")"}]}], " ", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "this", " ", "extra", " ", "factor", " ", "of", " ", "Pi", " ", 
             "is", " ", "there", " ", "because", " ", "of", " ", "constant", 
             " ", 
             RowBox[{"terms", ".", " ", "Note"}], " ", "that", " ", 
             "choosing", " ", "to", " ", "integrate", " ", "over", " ", "u"}],
             "+", " ", 
            RowBox[{
            "gives", " ", "us", " ", "the", " ", "factors", " ", "of", " ", 
             RowBox[{"2", "^", 
              RowBox[{"(", "..", ")"}]}], " ", "as", " ", "well", " ", "as", 
             " ", "the", " ", "product", " ", "u1"}], "+", " ", "u2", "+"}], 
           " ", "..."}], " ", "un"}], "-", "1", "+", " ", 
         RowBox[{
          RowBox[{"u", "'"}], "1"}], "+", "."}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
                "replaceRule\[Theta]"}], ")"}], "//.", "replaceRuleR2"}], 
             ")"}], "//.", "replaceRule2"}], ")"}], "//", "Cancel"}], "//", 
         "Expand"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7323023908639727`*^9, 3.732302414065888*^9}, 
   3.732302459312894*^9, {3.7323024896335487`*^9, 3.732302537149873*^9}, {
   3.73230276683427*^9, 3.732302794529438*^9}, {3.7323028614127502`*^9, 
   3.732302905356347*^9}, {3.732303754027483*^9, 3.732303764179853*^9}, {
   3.732375507005609*^9, 3.732375515596902*^9}, 3.7324653141771917`*^9, {
   3.7324667362803926`*^9, 3.732466798508753*^9}, {3.732468058628413*^9, 
   3.732468218783828*^9}, {3.732468258014163*^9, 3.732468481734124*^9}, {
   3.732469061960368*^9, 3.732469084885483*^9}, {3.732469131194077*^9, 
   3.732469154302677*^9}, {3.732469862949312*^9, 3.732469913214756*^9}, {
   3.7324699705843983`*^9, 3.732470044841889*^9}, {3.732471511983301*^9, 
   3.7324715190764914`*^9}, 3.7324730676106253`*^9, {3.7324784316345787`*^9, 
   3.732478565771891*^9}, 3.732478665386045*^9, {3.732549874511047*^9, 
   3.732549969048038*^9}, {3.733587212600893*^9, 3.733587232359427*^9}, {
   3.733588377346189*^9, 3.733588379657856*^9}, {3.733588478329451*^9, 
   3.733588481009426*^9}, {3.733588541332136*^9, 3.7335885450017643`*^9}, {
   3.7335887958993177`*^9, 3.733588799355649*^9}, {3.733588917827553*^9, 
   3.733588920499796*^9}, {3.7335894928754*^9, 3.733589510810769*^9}, {
   3.733589656580002*^9, 3.733589662666374*^9}, {3.7335897395495787`*^9, 
   3.733589787078291*^9}, {3.733590370938265*^9, 3.733590379025333*^9}, {
   3.733591111596985*^9, 3.733591126801127*^9}, {3.7335914326637363`*^9, 
   3.733591499182048*^9}, {3.733591538226754*^9, 3.733591560116571*^9}, {
   3.733591606209572*^9, 3.73359164376775*^9}, 3.733591965172163*^9, {
   3.7336173860965*^9, 3.733617398971203*^9}, {3.733617449942378*^9, 
   3.733617542482727*^9}, 3.7336187379916687`*^9, {3.733670045858536*^9, 
   3.733670046648615*^9}, 3.733680350189622*^9, 3.733680580442629*^9, {
   3.7336806477776823`*^9, 3.7336806482017937`*^9}, {3.734114809162099*^9, 
   3.734114835543112*^9}, {3.734122017012063*^9, 3.734122178003738*^9}, {
   3.734122234862664*^9, 3.7341222658663588`*^9}, {3.7341223010795383`*^9, 
   3.7341223850962467`*^9}, {3.734123085666217*^9, 3.7341230925067387`*^9}, {
   3.73445837879056*^9, 3.734458381792285*^9}, 3.734799241742981*^9, {
   3.7347993506627274`*^9, 3.734799353996479*^9}, {3.734799993442037*^9, 
   3.734799997385627*^9}, {3.734800057966155*^9, 3.7348000595858507`*^9}, {
   3.734800110290793*^9, 3.734800114190524*^9}, 3.735400746002378*^9, {
   3.735405462870158*^9, 3.735405464661913*^9}, 3.735419121435226*^9, {
   3.7354191590629587`*^9, 3.735419161716424*^9}, {3.735421099256482*^9, 
   3.7354211267216787`*^9}, {3.735423403857465*^9, 3.735423440144746*^9}, {
   3.7354939760219507`*^9, 3.735493977228158*^9}, {3.735501474106175*^9, 
   3.7355014816912117`*^9}, 3.735501534353537*^9, {3.735501575643207*^9, 
   3.7355015898024397`*^9}, {3.736529574142597*^9, 3.73652958350886*^9}, {
   3.736529776266017*^9, 3.7365297983119793`*^9}, 3.736529875864389*^9, {
   3.736531081598819*^9, 3.736531392308278*^9}, {3.73653160520408*^9, 
   3.736531620940488*^9}, {3.736533010161442*^9, 3.736533116011236*^9}, {
   3.736535570501051*^9, 3.736535572033699*^9}, {3.73653951732272*^9, 
   3.736539519697603*^9}, {3.759694647524959*^9, 3.759694652061005*^9}, {
   3.759694841253751*^9, 3.7596948438586187`*^9}, {3.759695002380335*^9, 
   3.759695023212228*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"47d6b581-d7c3-409a-b321-ec7c8a9df0de"]
}, Closed]],

Cell[CellGroupData[{

Cell["N\[Rule]N+2", "Subsection",
 CellChangeTimes->{{3.7535434642116137`*^9, 
  3.753543482671788*^9}},ExpressionUUID->"f44a8dec-4a9f-4959-9569-\
96c2854f58a0"],

Cell[TextData[{
 "MODIFIED (Instead of \[Mu],\[Mu]\[CloseCurlyQuote], use \[Alpha] = \[Mu]/\
\[Mu]\[CloseCurlyQuote] and \[Beta] = ",
 Cell[BoxData[
  FormBox[
   SqrtBox[
    RowBox[{"1", "-", 
     SuperscriptBox["\[Alpha]", "2"]}]], TraditionalForm]],ExpressionUUID->
  "f2f73be9-4436-42d6-a3bc-7ff7a7119b4b"],
 ". Also, fixed n=2.)"
}], "Text",
 CellChangeTimes->{{3.7535784747463923`*^9, 3.753578479552453*^9}, {
  3.753614427219595*^9, 3.75361443123239*^9}, {3.753615863562718*^9, 
  3.753615922989389*^9}, {3.762966848187356*^9, 
  3.7629668562251663`*^9}},ExpressionUUID->"8f6c68e1-b921-4d5e-a090-\
bbdfd4e39f07"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "convertVariablesNtoN2", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"convertVariablesNtoN2", "[", 
   RowBox[{"state1_", ",", "state2_", ",", "n_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"convertVariablesNtoN2", "[", 
    RowBox[{"state1", ",", "state2", ",", "n"}], "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xTable", ",", "xTableP", ",", "yTable", ",", "yTableP", ",", 
       "\[Theta]Table", ",", "setPrimedtoUnPrimed", ",", "setyTilde12", ",", 
       "temp"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xTable", "=", 
       RowBox[{"generatexTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xTableP", "=", 
       RowBox[{"generatexTable", "[", 
        RowBox[{
         RowBox[{"n", "+", "2"}], ",", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yTable", "=", 
       RowBox[{"generateyTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yTableP", "=", 
       RowBox[{"generateyTable", "[", 
        RowBox[{
         RowBox[{"n", "+", "2"}], ",", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Theta]Table", "=", 
       RowBox[{"generate\[Theta]Table", "[", 
        RowBox[{"n", ",", "1", ",", "1"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"setPrimedtoUnPrimed", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<yt\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], 
             "\[Rule]", 
             RowBox[{"\[Alpha]", "*", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<yt\>\"", "<>", 
                RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}]}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"setyTilde12", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt1'\>\"", "]"}], "\[Rule]", " ", 
          
          RowBox[{"\[Beta]", " ", 
           RowBox[{"Sin", "[", "\[Theta]p", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt2'\>\"", "]"}], "\[Rule]", 
          RowBox[{"\[Beta]", " ", 
           RowBox[{"Cos", "[", "\[Theta]p", "]"}]}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"state1", "//.", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTable", ",", "yTable"}], "}"}], "]"}]}], ")"}], 
                  
                  RowBox[{"(", 
                   RowBox[{"state2", "//.", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTableP", ",", "yTableP", ",", "setyTilde12"}], 
                    "}"}], "]"}]}], ")"}]}], ")"}], "//.", 
                "setPrimedtoUnPrimed"}], ")"}], "//.", "\[Theta]Table"}], " ",
              ")"}], "//.", 
            RowBox[{"{", 
             RowBox[{"\[Mu]", "\[Rule]", "0"}], "}"}]}], "//", "Expand"}], 
          "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"temp", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"state1", "//.", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"xTable", ",", "yTable"}], "}"}], "]"}]}], ")"}], 
              RowBox[{"(", 
               RowBox[{"state2", "//.", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"xTableP", ",", "yTableP", ",", "setyTilde12"}], 
                  "}"}], "]"}]}], ")"}]}], ")"}], "//.", 
            "setPrimedtoUnPrimed"}], ")"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"temp", "//.", 
               RowBox[{"{", 
                RowBox[{"yt1", "\[Rule]", "1"}], "}"}]}], ")"}], "+", " ", 
             RowBox[{"(", 
              RowBox[{"temp", "//.", 
               RowBox[{"{", 
                RowBox[{"yt1", "\[Rule]", 
                 RowBox[{"-", "1"}]}], "}"}]}], ")"}]}], ")"}], "//", 
           "Expand"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"state1", "//.", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{"xTable", ",", "yTable"}], "}"}], "]"}]}], ")"}], 
             RowBox[{"(", 
              RowBox[{"state2", "//.", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{"xTableP", ",", "yTableP", ",", "setyTilde12"}], 
                 "}"}], "]"}]}], ")"}]}], ")"}], "//.", 
           "setPrimedtoUnPrimed"}], ")"}], "//.", "\[Theta]Table"}], " ", "//",
         "Expand"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.732295628970669*^9, 3.732295629644271*^9}, {
   3.732295679873678*^9, 3.732295682663341*^9}, {3.732299200739017*^9, 
   3.732299285491095*^9}, {3.732300823398486*^9, 3.732300886108374*^9}, {
   3.7323011277678022`*^9, 3.732301177915501*^9}, {3.732301224059596*^9, 
   3.732301284151853*^9}, {3.732301326170244*^9, 3.732301497700275*^9}, {
   3.732301589253594*^9, 3.732301590606831*^9}, {3.732301931164215*^9, 
   3.732301955157157*^9}, {3.732301994458394*^9, 3.732302049514152*^9}, {
   3.732303461666658*^9, 3.732303515811612*^9}, {3.732303580978135*^9, 
   3.732303585274418*^9}, {3.732303662399221*^9, 3.7323037106196537`*^9}, {
   3.732374325676305*^9, 3.73237451747447*^9}, {3.732375020016006*^9, 
   3.732375026462543*^9}, 3.73237511965763*^9, {3.732375164090925*^9, 
   3.7323751705613527`*^9}, {3.732389415599842*^9, 3.732389496728368*^9}, {
   3.732389780771347*^9, 3.732389874883027*^9}, {3.732389905172613*^9, 
   3.7323899080044737`*^9}, {3.7323962356784077`*^9, 3.732396289759306*^9}, {
   3.7324672475549707`*^9, 3.732467339605816*^9}, {3.732468027823539*^9, 
   3.732468043430237*^9}, {3.7324692018264017`*^9, 3.732469207320732*^9}, {
   3.732469282800639*^9, 3.732469330113138*^9}, {3.732471918536046*^9, 
   3.732471934045784*^9}, {3.73350827759319*^9, 3.7335083071208*^9}, {
   3.7335084427640047`*^9, 3.733508459787216*^9}, {3.733509012177702*^9, 
   3.733509031011614*^9}, {3.733509843802367*^9, 3.7335098815166407`*^9}, {
   3.733512251560656*^9, 3.733512266273658*^9}, {3.7335122965056868`*^9, 
   3.7335123247137833`*^9}, {3.733513538462538*^9, 3.733513565838587*^9}, {
   3.733513808314374*^9, 3.733513843242112*^9}, {3.7335141093325567`*^9, 
   3.7335142424473257`*^9}, {3.733514279840988*^9, 3.7335143231697817`*^9}, {
   3.733514355448926*^9, 3.733514424991356*^9}, 3.733581567712491*^9, {
   3.733582374773058*^9, 3.733582436310239*^9}, {3.7335825616465607`*^9, 
   3.733582589622759*^9}, {3.733586329022789*^9, 3.73358636617205*^9}, {
   3.733586418917562*^9, 3.733586466797999*^9}, {3.7335868605500307`*^9, 
   3.7335868706133337`*^9}, {3.733587146007759*^9, 3.73358716226864*^9}, {
   3.733594779594564*^9, 3.733594804848538*^9}, {3.733594842170911*^9, 
   3.733594880113159*^9}, {3.733595187205309*^9, 3.733595235752293*^9}, {
   3.733595275100341*^9, 3.733595332228051*^9}, {3.7335954218800707`*^9, 
   3.733595478358629*^9}, 3.734803996035448*^9, {3.737655177781124*^9, 
   3.737655215021236*^9}, {3.737767939906157*^9, 3.737767944035659*^9}, {
   3.753578498233931*^9, 3.75357850513461*^9}, {3.7535786015976963`*^9, 
   3.753578617298369*^9}, {3.762965842197075*^9, 3.762965852381033*^9}, {
   3.762966154378565*^9, 3.762966158189188*^9}, {3.76296636905905*^9, 
   3.762966415757593*^9}, 3.762966496240003*^9, {3.762993779426836*^9, 
   3.762993783975336*^9}, {3.762995414207378*^9, 3.76299541712325*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"adeaae51-2987-44ad-bbdd-f35b3c3be810"],

Cell["UNMODIFIED:", "Text",
 CellChangeTimes->{{3.753615934469701*^9, 
  3.7536159369134703`*^9}},ExpressionUUID->"b495b347-055d-4c1c-a85d-\
5c33a61de151"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "NtoN2", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NtoN2", "[", 
    RowBox[{"n_", ",", "productFiFj_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"NtoN2", "[", 
     RowBox[{"n", ",", "productFiFj"}], "]"}], "=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ups", ",", "ums", ",", "uPrimes", ",", "Sin\[Theta]s", ",", 
        "\[Theta]Prime", ",", "Cos\[Theta]s", ",", "vsandws", ",", "angles", 
        ",", "integrand", ",", " ", "coeffRules", ",", "coeffs", ",", 
        "coeffpowers", ",", "powers", ",", "ref", ",", " ", "replaceRule", 
        ",", "replaceRule\[Theta]", ",", "replaceRule\[Theta]Prime"}], "}"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "2"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sin\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<S\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Cos\[Theta]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<C\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}]}], ";"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Theta]Prime", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Sin", "[", "\[Theta]p", "]"}], ",", 
          RowBox[{"Cos", "[", "\[Theta]p", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ups", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ums", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"uPrimes", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"up1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}], ",", 
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"um1\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}], ",", 
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"up2\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}], ",", 
          RowBox[{
          "ToExpression", "[", 
           "\"\<\!\(\*SuperscriptBox[\"um2\", \
\"\[Prime]\",MultilineFunction->None]\)\>\"", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "we", " ", "compute", " ", "the", " ", "replacement", " ", "rules"}],
          ",", " ", 
         RowBox[{"using", " ", "the", " ", "reference", " ", "integrals"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"replaceRule", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"x_", " ", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ums", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 SuperscriptBox[
                  RowBox[{"ups", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
                
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"l", ",", "0"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                RowBox[{"x", " ", 
                 RowBox[{"refUpUm", "[", 
                  RowBox[{"1", ",", "0"}], "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "k_"], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"x_", " ", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "l"}], "]"}], 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"l", ",", "k"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "k"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"refUpUm", "[", 
                RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"replaceRule\[Theta]Prime", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "k_"], 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "l_"]}], ":>", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "k_"], 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ":>", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "l_"]}], ":>", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            SuperscriptBox[
             RowBox[{"\[Theta]Prime", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "l_"]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"0", ",", "l"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"x_", "/;", 
             RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
            RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
            RowBox[{"\[Theta]Prime", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"x", " ", 
            RowBox[{"ref\[Theta]Last", "[", 
             RowBox[{"0", ",", "1"}], "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "3"}], ",", " ", 
         RowBox[{
          RowBox[{"replaceRule\[Theta]", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
               SuperscriptBox[
                RowBox[{"Sin\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
               SuperscriptBox[
                RowBox[{"Cos\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"Sin\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"], 
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}]}], ":>", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"Cos\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "l_"]}], ":>", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}], 
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"x_", "/;", 
                RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
               RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               RowBox[{"Cos\[Theta]s", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "-", "2"}], "]"}], "]"}]}], "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"Sin\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
              "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x_", "/;", 
                 RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
               SuperscriptBox[
                RowBox[{"Cos\[Theta]s", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "-", "2"}], "]"}], "]"}], "k_"]}], 
              "\[RuleDelayed]", 
              RowBox[{"x", " ", 
               RowBox[{"ref\[Theta]Last", "[", 
                RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], ";"}]}], "]"}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", ">", "3"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"replaceRule\[Theta]", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "l_"]}], ":>", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                   RowBox[{"x", " ", 
                    RowBox[{"ref\[Theta]", "[", 
                    RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "2", ",", 
                  RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], 
                  SuperscriptBox[
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  SuperscriptBox[
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"k", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  SuperscriptBox[
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"], 
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ":>", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"k", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "-", "2"}], "]"}], "]"}], 
                  SuperscriptBox[
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "l_"]}], ":>", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"1", ",", "l"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], 
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"1", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"x_", "/;", 
                   RowBox[{"NumericQ", "[", "x", "]"}]}], "\[RuleDelayed]", 
                  RowBox[{"Pi", " ", "x"}]}], "*)"}], " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"1", ",", "0"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  RowBox[{"Cos\[Theta]s", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"0", ",", "1"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  SuperscriptBox[
                   RowBox[{"Sin\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"k", ",", "0"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x_", "/;", 
                    RowBox[{"NumericQ", "[", "x", "]"}]}], ")"}], " ", 
                  SuperscriptBox[
                   RowBox[{"Cos\[Theta]s", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "k_"]}], "\[RuleDelayed]", 
                 RowBox[{"x", " ", 
                  RowBox[{"ref\[Theta]Last", "[", 
                   RowBox[{"0", ",", "k"}], "]"}]}]}]}], "}"}]}], "]"}]}]}], 
          ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"2", "Pi"}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"3", 
                 SuperscriptBox["Pi", "3"], 
                 SuperscriptBox["2", "7"]}]], "4", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}], " ", 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "4"], 
               RowBox[{"(*", "Pi", "*)"}], 
               RowBox[{"(", "productFiFj", ")"}]}], ")"}]}], "//", 
            "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "the", " ", "extra", " ", "factor", " ", "of", " ", "Pi", " ", 
            "before", " ", "productFiFj", " ", "above", " ", "is", " ", 
            "that", " ", "norm", " ", "of", " ", "1", "p", " ", "state", " ", 
            "shouldnt", " ", "be", " ", "double", " ", "counted", " ", 
            "using", " ", "eqn", " ", "in", " ", "MatrixFormulas"}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
                "replaceRule\[Theta]Prime"}], ")"}], ")"}], "//", "Expand"}], 
            "//", "Chop"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "2"}], ",", " ", 
         RowBox[{
          RowBox[{"integrand", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"2", "Pi"}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "-", "1"}], ")"}], "!"}], 
                 SuperscriptBox["2", 
                  RowBox[{
                   RowBox[{"2", "n"}], "+", "3"}]], "3", 
                 SuperscriptBox["Pi", 
                  RowBox[{"2", "n"}]]}]], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ups", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
                  SuperscriptBox[
                   RowBox[{"(", 
                    RowBox[{"ums", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                   RowBox[{
                    RowBox[{"5", "i"}], "+", "2"}]]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "2", "]"}], "]"}], 
               RowBox[{"uPrimes", "[", 
                RowBox[{"[", "3", "]"}], "]"}], 
               SuperscriptBox[
                RowBox[{"uPrimes", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "4"], 
               RowBox[{"Product", "[", 
                RowBox[{
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
               RowBox[{"Product", "[", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"Sin\[Theta]s", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], 
                  RowBox[{"i", "-", "1"}]], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], "productFiFj"}],
               ")"}]}], " ", "//", "ExpandAll"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"(", 
                RowBox[{"integrand", "//.", "replaceRule"}], ")"}], ")"}], "//.",
               "replaceRule\[Theta]Prime"}], ")"}], "//", "Expand"}], "]"}], 
          ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"integrand", "=", 
        RowBox[{
         RowBox[{
          SuperscriptBox["Pi", 
           RowBox[{"n", "-", "3"}]], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"2", "Pi"}], ")"}], "2"], 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "1"}], ")"}], "!"}], 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "n"}], "+", "3"}]], "3", 
              SuperscriptBox["Pi", 
               RowBox[{"2", "n"}]]}]], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "3", "]"}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ups", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], "3"], 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ums", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ")"}], 
                RowBox[{
                 RowBox[{"5", "i"}], "+", "2"}]]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], 
            RowBox[{"uPrimes", "[", 
             RowBox[{"[", "3", "]"}], "]"}], 
            SuperscriptBox[
             RowBox[{"uPrimes", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "4"], 
            RowBox[{"Product", "[", 
             RowBox[{
              RowBox[{"ups", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], 
            RowBox[{"Product", "[", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"Sin\[Theta]s", "[", 
                RowBox[{"[", "i", "]"}], "]"}], 
               RowBox[{"i", "-", "1"}]], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"n", "-", "2"}]}], "}"}]}], "]"}], "productFiFj"}], 
           ")"}]}], " ", "//", "ExpandAll"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "this", " ", "extra", " ", "factor", " ", "of", " ", "Pi", " ", 
              "is", " ", "there", " ", "because", " ", "of", " ", "constant", 
              " ", 
              RowBox[{"terms", ".", " ", "Note"}], " ", "that", " ", 
              "choosing", " ", "to", " ", "integrate", " ", "over", " ", 
              "u"}], "+", " ", 
             RowBox[{
             "gives", " ", "us", " ", "the", " ", "factors", " ", "of", " ", 
              RowBox[{"2", "^", 
               RowBox[{"(", "..", ")"}]}], " ", "as", " ", "well", " ", "as", 
              " ", "the", " ", "product", " ", "u1"}], "+", " ", "u2", "+"}], 
            " ", "..."}], " ", "un"}], "-", "1", "+", " ", 
          RowBox[{
           RowBox[{"u", "'"}], "1"}], "+", 
          RowBox[{".", " ", "Also"}]}], ",", " ", 
         RowBox[{
          RowBox[{"the", " ", "theta", " ", "integral", " ", 
           RowBox[{"from", " ", "[", 
            RowBox[{"0", ",", 
             RowBox[{"2", "Pi"}]}], "]"}]}], " ", "=", " ", 
          RowBox[{"2", " ", "*", " ", "the", " ", "one", " ", 
           RowBox[{
            RowBox[{"from", " ", "[", 
             RowBox[{"0", ",", "Pi"}], "]"}], ".", " ", "So"}], " ", "this", 
           " ", "kills", " ", "those", " ", "factors", " ", "of", " ", 
           "2."}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"integrand", "//.", "replaceRule"}], ")"}], "//.", 
             "replaceRule\[Theta]"}], ")"}], "//.", 
           "replaceRule\[Theta]Prime"}], ")"}], "//", "Expand"}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7323023908639727`*^9, 3.732302414065888*^9}, 
   3.732302459312894*^9, {3.7323024896335487`*^9, 3.732302537149873*^9}, {
   3.73230276683427*^9, 3.732302794529438*^9}, {3.7323028614127502`*^9, 
   3.732302905356347*^9}, {3.732303754027483*^9, 3.732303764179853*^9}, {
   3.732375507005609*^9, 3.732375515596902*^9}, 3.7324653141771917`*^9, {
   3.7324667362803926`*^9, 3.732466798508753*^9}, {3.732468058628413*^9, 
   3.732468218783828*^9}, {3.732468258014163*^9, 3.732468481734124*^9}, {
   3.732469061960368*^9, 3.732469084885483*^9}, {3.732469131194077*^9, 
   3.732469154302677*^9}, {3.732469862949312*^9, 3.732469913214756*^9}, {
   3.7324699705843983`*^9, 3.732470044841889*^9}, {3.732471511983301*^9, 
   3.7324715190764914`*^9}, 3.7324730676106253`*^9, {3.7324784316345787`*^9, 
   3.732478565771891*^9}, 3.732478665386045*^9, {3.732549874511047*^9, 
   3.732549969048038*^9}, {3.733587212600893*^9, 3.733587232359427*^9}, {
   3.733588377346189*^9, 3.733588379657856*^9}, {3.733588478329451*^9, 
   3.733588481009426*^9}, {3.733588541332136*^9, 3.7335885450017643`*^9}, {
   3.7335887958993177`*^9, 3.733588799355649*^9}, {3.733588917827553*^9, 
   3.733588920499796*^9}, {3.7335894928754*^9, 3.733589510810769*^9}, {
   3.733589656580002*^9, 3.733589662666374*^9}, {3.7335897395495787`*^9, 
   3.733589787078291*^9}, {3.733590370938265*^9, 3.733590379025333*^9}, {
   3.733591111596985*^9, 3.733591126801127*^9}, {3.7335914326637363`*^9, 
   3.733591499182048*^9}, {3.733591538226754*^9, 3.733591560116571*^9}, {
   3.733591606209572*^9, 3.73359164376775*^9}, 3.733591965172163*^9, {
   3.7335960947447357`*^9, 3.7335960955839863`*^9}, {3.733613997220388*^9, 
   3.733614009740067*^9}, {3.733616653363202*^9, 3.733616668718444*^9}, {
   3.733616700873126*^9, 3.733616784820928*^9}, {3.7336176821441793`*^9, 
   3.7336177365156813`*^9}, {3.7336183988193703`*^9, 3.73361840806339*^9}, {
   3.7336184438796587`*^9, 3.733618537689938*^9}, {3.7336185997256403`*^9, 
   3.7336186471862593`*^9}, {3.733618680921546*^9, 3.733618719107236*^9}, {
   3.733618761545703*^9, 3.733618836246673*^9}, {3.733670098483411*^9, 
   3.733670099220705*^9}, {3.733670372007516*^9, 3.7336703721901484`*^9}, {
   3.7336782457030897`*^9, 3.7336783908697042`*^9}, {3.733747842649776*^9, 
   3.733747895149242*^9}, {3.733747925799588*^9, 3.7337479622710648`*^9}, {
   3.733753032329859*^9, 3.733753043402122*^9}, {3.733754400790741*^9, 
   3.733754427207665*^9}, {3.7337568563704443`*^9, 3.7337568574960337`*^9}, {
   3.7337587675716333`*^9, 3.733758779978899*^9}, {3.734275523037127*^9, 
   3.73427553175353*^9}, {3.734275574660365*^9, 3.734275575622324*^9}, 
   3.7342760154287357`*^9, {3.734276061879882*^9, 3.7342760930636177`*^9}, 
   3.734276141961844*^9, {3.734276191306181*^9, 3.734276196097219*^9}, {
   3.734276253426635*^9, 3.734276276202901*^9}, {3.734276518684308*^9, 
   3.73427652388272*^9}, {3.734283170608951*^9, 3.734283186337942*^9}, {
   3.734283219696972*^9, 3.7342832251847763`*^9}, {3.734283514891407*^9, 
   3.7342836591481457`*^9}, {3.734283697971868*^9, 3.734283797310018*^9}, {
   3.7342838444002733`*^9, 3.7342838461600227`*^9}, {3.7342842865664463`*^9, 
   3.734284292504601*^9}, {3.734284995454873*^9, 3.734284998182317*^9}, {
   3.734285487431046*^9, 3.7342854887145643`*^9}, {3.734285557463669*^9, 
   3.73428555773481*^9}, {3.7342862430734262`*^9, 3.734286249425495*^9}, {
   3.734286855365428*^9, 3.734286860023014*^9}, {3.734287745839242*^9, 
   3.734287749390091*^9}, 3.7342878164153557`*^9, {3.734287943953771*^9, 
   3.734288000287189*^9}, 3.736273247057324*^9, 3.736274879135283*^9, {
   3.736515715895845*^9, 3.736515719975711*^9}, {3.7365316752109423`*^9, 
   3.7365316913259068`*^9}, {3.736531747247026*^9, 3.736531819510524*^9}, 
   3.736531851469699*^9, {3.736531908534704*^9, 3.736531985269311*^9}, {
   3.736532039941761*^9, 3.7365320493347178`*^9}, {3.736533192754998*^9, 
   3.736533218059462*^9}, {3.736533400182444*^9, 3.7365334283269*^9}, {
   3.736533523550385*^9, 3.736533532246394*^9}, {3.736534532646557*^9, 
   3.73653454893696*^9}, {3.736534626431797*^9, 3.736534667604323*^9}, {
   3.7365347030527887`*^9, 3.736534730490014*^9}, {3.7365392588920794`*^9, 
   3.736539270374364*^9}, {3.736539345752378*^9, 3.736539349688663*^9}, {
   3.736539383589971*^9, 3.736539386535533*^9}, {3.736539425305975*^9, 
   3.736539434625424*^9}, {3.7365413978758717`*^9, 3.736541418686068*^9}, 
   3.7365415278909616`*^9, {3.74016984917692*^9, 3.7401698672779408`*^9}, {
   3.740170807119726*^9, 3.7401708370136213`*^9}, {3.740170872849188*^9, 
   3.740170874277955*^9}, 3.7401709097787113`*^9, {3.740765026322474*^9, 
   3.74076504890724*^9}, {3.7407657316582937`*^9, 3.7407657737208033`*^9}, 
   3.742323522616309*^9},
 CellLabel->"In[35]:=",ExpressionUUID->"0d4af10a-98ad-4c1f-81a2-24e5097da687"],

Cell[TextData[{
 "OLD (Uses \[Mu],\[Mu]\[CloseCurlyQuote] instead of \[Alpha] = \[Mu]/\[Mu]\
\[CloseCurlyQuote] and \[Beta] = ",
 Cell[BoxData[
  FormBox[
   SqrtBox[
    RowBox[{"1", "-", 
     SuperscriptBox["\[Alpha]", "2"]}]], TraditionalForm]],ExpressionUUID->
  "2e680a4f-b269-4c15-9cdf-fd88d6458d14"],
 ")"
}], "Text",
 CellChangeTimes->{{3.762171491888104*^9, 
  3.762171523756158*^9}},ExpressionUUID->"683d85d8-523a-4352-ad39-\
66cc0d7c5918"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "convertVariablesNtoN2OLD", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"convertVariablesNtoN2OLD", "[", 
   RowBox[{"state1_", ",", "state2_", ",", "n_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"convertVariablesNtoN2OLD", "[", 
    RowBox[{"state1", ",", "state2", ",", "n"}], "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xTable", ",", "xTableP", ",", "yTable", ",", "yTableP", ",", 
       "\[Theta]Table", ",", "setPrimedtoUnPrimed", ",", "setyTilde12"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xTable", "=", 
       RowBox[{"generatexTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xTableP", "=", 
       RowBox[{"generatexTable", "[", 
        RowBox[{
         RowBox[{"n", "+", "2"}], ",", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yTable", "=", 
       RowBox[{"generateyTable", "[", "n", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yTableP", "=", 
       RowBox[{"generateyTable", "[", 
        RowBox[{
         RowBox[{"n", "+", "2"}], ",", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Theta]Table", "=", 
       RowBox[{"generate\[Theta]Table", "[", 
        RowBox[{"n", ",", "1", ",", "1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"setPrimedtoUnPrimed", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<up\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], "->", 
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<um\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"ToExpression", "[", 
              RowBox[{"\"\<yt\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "+", "2"}], "]"}], "<>", "\"\<'\>\""}], "]"}], 
             "\[Rule]", 
             RowBox[{
              FractionBox["\[Mu]", "\[Mu]p"], 
              RowBox[{"ToExpression", "[", 
               RowBox[{"\"\<yt\>\"", "<>", 
                RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}]}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "//", "Flatten"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"setyTilde12", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt1'\>\"", "]"}], "\[Rule]", " ", 
          
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox["\[Mu]", "2"], 
              SuperscriptBox["\[Mu]p", "2"]]}], "]"}], " ", 
           RowBox[{"Sin", "[", "\[Theta]p", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"ToExpression", "[", "\"\<yt2'\>\"", "]"}], "\[Rule]", 
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox["\[Mu]", "2"], 
              SuperscriptBox["\[Mu]p", "2"]]}], "]"}], " ", 
           RowBox[{"Cos", "[", "\[Theta]p", "]"}]}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"state1", "//.", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTable", ",", "yTable"}], "}"}], "]"}]}], ")"}], 
                  
                  RowBox[{"(", 
                   RowBox[{"state2", "//.", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"xTableP", ",", "yTableP", ",", "setyTilde12"}], 
                    "}"}], "]"}]}], ")"}]}], ")"}], "//.", 
                "setPrimedtoUnPrimed"}], ")"}], "//.", "\[Theta]Table"}], " ",
              ")"}], "//.", 
            RowBox[{"{", 
             RowBox[{"\[Mu]", "\[Rule]", "0"}], "}"}]}], "//", "Expand"}], 
          "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"state1", "//.", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{"xTable", ",", "yTable"}], "}"}], "]"}]}], ")"}], 
             RowBox[{"(", 
              RowBox[{"state2", "//.", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{"xTableP", ",", "yTableP", ",", "setyTilde12"}], 
                 "}"}], "]"}]}], ")"}]}], ")"}], "//.", 
           "setPrimedtoUnPrimed"}], ")"}], "//.", "\[Theta]Table"}], " ", "//",
         "Expand"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.762171535441414*^9, 3.762171543219548*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"82242f92-c996-48df-bcaa-eba1080a6446"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Generate Data", "Section",
 CellChangeTimes->{{3.770656954277915*^9, 
  3.770656956297847*^9}},ExpressionUUID->"5fc41128-4e6b-4bdb-a4fa-\
5f44de63bc01"],

Cell[BoxData[
 RowBox[{
  RowBox[{"npart", "=", "3"}], ";"}]], "Input",
 CellChangeTimes->{{3.770656959960897*^9, 3.770656961620069*^9}, {
  3.7706578097792788`*^9, 3.770657809869515*^9}, {3.770659203717486*^9, 
  3.770659203858746*^9}, {3.77065927951443*^9, 3.770659279628827*^9}, {
  3.770659393665959*^9, 3.770659393787388*^9}, {3.770693427261801*^9, 
  3.770693427421033*^9}, {3.770695432756145*^9, 3.770695434164117*^9}, {
  3.770697749985668*^9, 3.770697750130142*^9}, {3.770698784413293*^9, 
  3.770698784920803*^9}, {3.770698877834828*^9, 3.770698878008009*^9}, {
  3.770698923199923*^9, 3.770698923606132*^9}, {3.798104357540316*^9, 
  3.798104358130212*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"cede10b9-3810-4304-90c6-6bb0127d5aee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{
   "\"\</Users/khandker/Dropbox/Higher D Basis/Zuhair/Dmax18 Data/Basis\>\"", 
    "<>", 
    RowBox[{"ToString", "[", "npart", "]"}], "<>", "\"\<_Dmax18\>\""}], "]"}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.798104366334313*^9, 3.798104376128326*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"74273777-6f2b-4df9-bd50-aef953f1b321"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mons", "=", 
   RowBox[{"ToExpression", "[", 
    RowBox[{"\"\<mons\>\"", "<>", 
     RowBox[{"ToString", "[", "npart", "]"}]}], "]"}]}], ";"}]], "Input",
 CellLabel->"In[42]:=",ExpressionUUID->"df0a5356-557b-4db3-8aeb-a1f9e8a2b416"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"mons", "//", "Length"}]], "Input",
 CellChangeTimes->{{3.7706954440647697`*^9, 3.770695446553051*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"05335499-8cdd-4c84-9790-761f5cd60414"],

Cell[BoxData["145"], "Output",
 CellChangeTimes->{3.7706954472104397`*^9, 3.770697758979454*^9, 
  3.770698792459161*^9, 3.7706988829841747`*^9, 3.770698930317582*^9, 
  3.79810438569149*^9},
 CellLabel->"Out[43]=",ExpressionUUID->"90359ebb-b70f-446a-b4f0-8f56a29e2b66"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"t1", "=", 
    RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"MonMassTable", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"MassFT", "[", 
          RowBox[{
           RowBox[{"mons", "[", 
            RowBox[{"[", "row", "]"}], "]"}], ",", 
           RowBox[{"mons", "[", 
            RowBox[{"[", "col", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"row", ",", 
           RowBox[{"Length", "[", "mons", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"col", ",", "row"}], "}"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", ",", 
     RowBox[{"{", 
      RowBox[{"row", ",", "col"}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t2", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Elapsed Time: \>\"", "<>", 
   RowBox[{"ToString", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"t2", "-", "t1"}], ")"}], "/", "60"}], "//", "N"}], "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.770657015859352*^9, 3.770657030212866*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"2d89f45b-1deb-4554-b5e0-286566d98d3a"],

Cell[BoxData["\<\"Elapsed Time: 2.60532\"\>"], "Print",
 CellChangeTimes->{3.770657042271533*^9, 3.770657874183127*^9, 
  3.770659209617708*^9, 3.7706593290234118`*^9, 3.770660030723261*^9, 
  3.770693299529071*^9, 3.7706951550458393`*^9, 3.77069723310756*^9, 
  3.770697847091784*^9, 3.7706988362929277`*^9, 3.770698885898035*^9, 
  3.770698933100281*^9, 3.798104567682938*^9},
 CellLabel->
  "During evaluation of \
In[44]:=",ExpressionUUID->"630bef71-df88-48ef-92e5-f60537cd72d4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TimeInMinutes", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"t2", "-", "t1"}], ")"}], "/", "60"}], "//", "N"}]}]], "Input",
 CellChangeTimes->{{3.798104755753004*^9, 3.7981047635565863`*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"a7f13bca-9bac-4456-965e-1322d84203a2"],

Cell[BoxData["2.605316833333333`"], "Output",
 CellChangeTimes->{3.798104765311914*^9},
 CellLabel->"Out[48]=",ExpressionUUID->"58b5e866-f87b-4f68-bfb5-83889954f7fa"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MonMassPad", "=", 
   RowBox[{"PadRight", "[", "MonMassTable", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MonMass", "=", 
   RowBox[{"MonMassPad", "+", 
    RowBox[{"Transpose", "[", "MonMassPad", "]"}], "-", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"Diagonal", "[", "MonMassPad", "]"}], "]"}]}]}], ";"}]}], "Input",\

 CellLabel->"In[49]:=",ExpressionUUID->"edd03a0e-3bb0-4898-beab-30291d6fd28e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "Save", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MonMass3", "=", "MonMass"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filename", "=", 
     RowBox[{"\"\<./Dmax18 Data/MonMass\>\"", "<>", 
      RowBox[{"ToString", "[", "npart", "]"}], "<>", "\"\<_Dmax18\>\""}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeleteFile", "[", "filename", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Save", "[", 
     RowBox[{"filename", ",", 
      RowBox[{"{", 
       RowBox[{"TimeInMinutes", ",", "MonMass3"}], "}"}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.77065714425633*^9, 3.7706571445058317`*^9}, {
  3.770657357368391*^9, 3.770657358174872*^9}, {3.770657914792452*^9, 
  3.770657918639188*^9}, {3.7706592157327414`*^9, 3.7706592180215197`*^9}, {
  3.770659335263143*^9, 3.770659337906954*^9}, {3.770693329149433*^9, 
  3.770693335040772*^9}, {3.770695248938311*^9, 3.770695253395219*^9}, {
  3.7706972702934237`*^9, 3.770697273708012*^9}, {3.770698744422558*^9, 
  3.770698748940793*^9}, {3.770698847441424*^9, 3.7706988505118217`*^9}, {
  3.770698891388077*^9, 3.770698894179195*^9}, {3.770698939666954*^9, 
  3.7706989436864367`*^9}, {3.7981048106137743`*^9, 3.798104837902391*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"e685409f-3bbf-4958-bd16-f316f11c6f18"],

Cell[BoxData[
 TemplateBox[{
  "DeleteFile","fdnfnd",
   "\"Directory or file \\!\\(\\*RowBox[{\\\"\\\\\\\"./Dmax18 \
Data/MonMass3_Dmax18\\\\\\\"\\\"}]\\) not found.\"",2,54,1,
   29451111294650273347,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.770657359494618*^9, 3.770657920445916*^9, 
  3.770659219409477*^9, 3.770659339508079*^9, 3.7706933382134533`*^9, 
  3.770695254734743*^9, 3.770697274755425*^9, 3.7706987505925694`*^9, 
  3.7706988513351297`*^9, 3.770698894784753*^9, 3.770698944523472*^9, 
  3.798104845490007*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"b5a9e2b7-e716-494f-806e-dc530bf953b9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Some", " ", "checks", " ", "using", " ", 
    RowBox[{"Nikhil", "'"}], "s", " ", "code"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"testrow", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"testcol", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7706573924654837`*^9, 3.770657421759191*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"f6f2dffc-0543-4244-a796-0fd4a072eba2"],

Cell[BoxData["16"], "Output",
 CellChangeTimes->{
  3.7706574230012703`*^9, {3.770657504147348*^9, 3.7706575178148327`*^9}, 
   3.7706579236862373`*^9, {3.77065923362813*^9, 3.770659257700687*^9}, {
   3.770659344098732*^9, 3.7706593665700274`*^9}, {3.7706933518806067`*^9, 
   3.7706933847002068`*^9}, 3.770695258777308*^9, 3.770697289234744*^9, 
   3.770698754386235*^9, 3.770698855116124*^9, {3.770698898499305*^9, 
   3.7706989032506847`*^9}, {3.770698948780854*^9, 3.7706989585000772`*^9}, 
   3.798106349698971*^9, {3.798114634597781*^9, 3.7981146360632563`*^9}},
 CellLabel->"Out[60]=",ExpressionUUID->"58dcd2de-ff9e-40ef-a3c9-972d8978838f"],

Cell[BoxData["138"], "Output",
 CellChangeTimes->{
  3.7706574230012703`*^9, {3.770657504147348*^9, 3.7706575178148327`*^9}, 
   3.7706579236862373`*^9, {3.77065923362813*^9, 3.770659257700687*^9}, {
   3.770659344098732*^9, 3.7706593665700274`*^9}, {3.7706933518806067`*^9, 
   3.7706933847002068`*^9}, 3.770695258777308*^9, 3.770697289234744*^9, 
   3.770698754386235*^9, 3.770698855116124*^9, {3.770698898499305*^9, 
   3.7706989032506847`*^9}, {3.770698948780854*^9, 3.7706989585000772`*^9}, 
   3.798106349698971*^9, {3.798114634597781*^9, 3.7981146360648317`*^9}},
 CellLabel->"Out[61]=",ExpressionUUID->"81e0f6b7-0ee5-46a9-99fa-14dca56e22a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"me", "=", 
  RowBox[{"MonMass", "[", 
   RowBox[{"[", 
    RowBox[{"testrow", ",", "testcol"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770657432218699*^9, 3.770657445951746*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"ae09387a-8d05-483b-83b5-78146aa868f6"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox["11027", 
   RowBox[{"515991425948384400", " ", "\[Pi]"}]]}]], "Output",
 CellChangeTimes->{{3.7706574391111403`*^9, 3.770657446610509*^9}, {
   3.7706575057496634`*^9, 3.7706575190266457`*^9}, 3.770657925507628*^9, {
   3.770659235236828*^9, 3.770659258594116*^9}, {3.770659346349279*^9, 
   3.770659367590774*^9}, {3.770693354088072*^9, 3.770693385915433*^9}, 
   3.770695260893054*^9, 3.77069729170249*^9, 3.7706987564488907`*^9, 
   3.770698857137188*^9, 3.7706989054184523`*^9, 3.7706989613397923`*^9, 
   3.798114638356694*^9},
 CellLabel->"Out[62]=",ExpressionUUID->"2840b703-0522-4e39-a3c6-fa781ddf0ca5"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Fb1", "=", 
   RowBox[{
    RowBox[{"convertVariables", "[", 
     RowBox[{
      RowBox[{"convertMonomial", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
         RowBox[{"mons", "[", 
          RowBox[{"[", "testrow", "]"}], "]"}]}], ",", "npart"}], "]"}], ",", 
      "npart"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fb2", "=", 
   RowBox[{
    RowBox[{"convertVariables", "[", 
     RowBox[{
      RowBox[{"convertMonomial", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
         RowBox[{"mons", "[", 
          RowBox[{"[", "testcol", "]"}], "]"}]}], ",", "npart"}], "]"}], ",", 
      "npart"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"nikhil", "=", 
  RowBox[{"massNik", "[", 
   RowBox[{"npart", ",", "Fb1", ",", "Fb2"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.770657450659018*^9, 3.770657492332138*^9}, {
  3.770659353041636*^9, 3.770659354921851*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"66172432-8d7b-49d4-ad44-a273ad6650a5"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox["11027", 
   RowBox[{"515991425948384400", " ", "\[Pi]"}]]}]], "Output",
 CellChangeTimes->{{3.770657493880506*^9, 3.770657520079698*^9}, {
   3.770659237676491*^9, 3.770659259474586*^9}, {3.770659349617737*^9, 
   3.770659368699238*^9}, {3.770693360537219*^9, 3.770693399876039*^9}, 
   3.7706953277383204`*^9, 3.770697690697513*^9, 3.7706990349083776`*^9, 
   3.798114640754163*^9},
 CellLabel->"Out[65]=",ExpressionUUID->"2bab8cc8-b2fa-4f32-a69d-276877765d6b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"me", "-", "nikhil"}]], "Input",
 CellChangeTimes->{{3.7706575229953823`*^9, 3.770657525892424*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"0de5b142-7992-43f9-9a2a-0c0a5c086ff2"],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{
  3.770657526853323*^9, {3.7706592398967533`*^9, 3.7706592604637012`*^9}, {
   3.770659358401451*^9, 3.7706593704885*^9}, {3.770693364198872*^9, 
   3.770693403924032*^9}, 3.770695408653014*^9, 3.798114643590913*^9},
 CellLabel->"Out[66]=",ExpressionUUID->"9c74d39a-a5a0-4432-a0df-25d72e742d0f"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Scracth", "Section",
 CellChangeTimes->{{3.769848802179433*^9, 3.769848803777122*^9}, {
  3.7706569463255243`*^9, 
  3.7706569473311157`*^9}},ExpressionUUID->"b5b41cbe-b011-4fe7-a931-\
d410b88b5668"],

Cell[CellGroupData[{

Cell["n=2 particles", "Subsection",
 CellChangeTimes->{{3.7698505030454473`*^9, 
  3.769850504933153*^9}},ExpressionUUID->"60e2828b-62d9-48b3-ba92-\
175009d71159"],

Cell[BoxData[
 RowBox[{
  RowBox[{"npart", "=", "2"}], ";"}]], "Input",
 CellChangeTimes->{{3.769848806307423*^9, 3.7698488080914173`*^9}, {
  3.7698501822056017`*^9, 3.76985018237779*^9}, {3.769850568448627*^9, 
  3.769850568551115*^9}},ExpressionUUID->"b4af1a59-3701-4861-b0fd-\
1a11a889cf4a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"\"\</Users/khandker/Dropbox/Higher D Basis/Zuhair/Basis\>\"", "<>", 
    RowBox[{"ToString", "[", "npart", "]"}], "<>", "\"\<_Dmax16\>\""}], "]"}],
   ";"}]}], "Input",ExpressionUUID->"160fbeb2-27d8-41ca-a7e3-ff1b543f61bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mons", "=", 
   RowBox[{"ToExpression", "[", 
    RowBox[{"\"\<mons\>\"", "<>", 
     RowBox[{"ToString", "[", "npart", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.769848871507718*^9, 3.769848872505576*^9}, 
   3.769848969459065*^9, 3.769849405333788*^9, 3.769849608792407*^9, 
   3.769850035911549*^9, {3.769850575092596*^9, 
   3.769850577480349*^9}},ExpressionUUID->"22d84de8-0f21-4b7f-a004-\
7887f98905bf"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"t1", "=", 
    RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"test", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Fb1", "=", 
           RowBox[{
            RowBox[{"convertVariables", "[", 
             RowBox[{
              RowBox[{"convertMonomial", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "+", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"mons", "[", 
                  RowBox[{"[", "row", "]"}], "]"}]}], ",", "npart"}], "]"}], 
              ",", "npart"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Fb2", "=", 
           RowBox[{
            RowBox[{"convertVariables", "[", 
             RowBox[{
              RowBox[{"convertMonomial", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "+", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"mons", "[", 
                  RowBox[{"[", "col", "]"}], "]"}]}], ",", "npart"}], "]"}], 
              ",", "npart"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"massNik", "[", 
           RowBox[{"npart", ",", "Fb1", ",", "Fb2"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"row", ",", 
           RowBox[{"Length", "[", "mons", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"col", ",", "row"}], "}"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", ",", 
     RowBox[{"{", 
      RowBox[{"row", ",", "col"}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t2", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Elapsed Time: \>\"", "<>", 
   RowBox[{"ToString", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"t2", "-", "t1"}], ")"}], "/", "60"}], "//", "N"}], "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.76984895193386*^9, 3.7698490552684383`*^9}, {
  3.769849192867169*^9, 3.7698492069522543`*^9}, {3.7698492684325047`*^9, 
  3.7698493801576138`*^9}, {3.769849824186467*^9, 3.769849833683978*^9}, {
  3.77065707762269*^9, 
  3.770657078037286*^9}},ExpressionUUID->"aa6df6ef-66f6-4f26-91ac-\
b5c4fb149190"],

Cell[BoxData["\<\"Elapsed Time: 0.00165028\"\>"], "Print",
 CellChangeTimes->{3.7698498362064743`*^9, 3.76985011956981*^9, 
  3.769850281519866*^9, 3.7698505802045717`*^9, 
  3.7706570796272497`*^9},ExpressionUUID->"a734f36a-01aa-446c-82b7-\
7703eccd8b55"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MonMassPad", "=", 
   RowBox[{"PadRight", "[", "MonMassTable", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MonMass", "=", 
   RowBox[{"MonMassPad", "+", 
    RowBox[{"Transpose", "[", "MonMassPad", "]"}], "-", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"Diagonal", "[", "MonMassPad", "]"}], "]"}]}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.769849741405149*^9, 
  3.7698497665978394`*^9}},ExpressionUUID->"8c635989-42e7-4b6e-904e-\
28516b99ab3d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "Save", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MonMass2", "=", "MonMass"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filename", "=", 
     RowBox[{"\"\<./MonMass\>\"", "<>", 
      RowBox[{"ToString", "[", "npart", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeleteFile", "[", "filename", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Save", "[", 
     RowBox[{"filename", ",", "MonMass2"}], "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.769849845056245*^9, 
  3.769849883397709*^9}},ExpressionUUID->"547e1e98-820f-42bf-9ad9-\
fce41358660c"],

Cell[BoxData[
 TemplateBox[{
  "DeleteFile","fdnfnd",
   "\"Directory or file \\!\\(\\*RowBox[{\\\"\\\\\\\"./MonMass2\\\\\\\"\\\"}]\
\\) not found.\"",2,54,1,29265947033609571487,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7698501417867737`*^9},ExpressionUUID->"37befe42-e6f6-4126-ae75-\
3023a3fd51f0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Some", " ", 
    RowBox[{"Checks", ".", " ", "Run"}], " ", "My", " ", "code", " ", "in", 
    " ", "Check24v6"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"testrow", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"testcol", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.769849934723962*^9, 
  3.769849944145698*^9}},ExpressionUUID->"ca490eb9-93da-4a1f-8ed7-\
00471eb6a484"],

Cell[BoxData["6"], "Output",
 CellChangeTimes->{{3.769849940209536*^9, 3.7698499476013737`*^9}, 
   3.7698501623882513`*^9, 
   3.769850605741489*^9},ExpressionUUID->"aa15ba18-122a-473e-82ca-\
24b13ed07894"],

Cell[BoxData["2"], "Output",
 CellChangeTimes->{{3.769849940209536*^9, 3.7698499476013737`*^9}, 
   3.7698501623882513`*^9, 
   3.769850605751747*^9},ExpressionUUID->"1d481fdc-7c6a-4e8b-bfa8-\
466b379ccc46"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"code", "=", 
  RowBox[{"MonMass", "[", 
   RowBox[{"[", 
    RowBox[{"testrow", ",", "testcol"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7698499558243628`*^9, 
  3.7698499693936243`*^9}},ExpressionUUID->"3c4f6f34-1e54-486f-b6c7-\
69befea18f3a"],

Cell[BoxData[
 FractionBox["429", "67108864"]], "Output",
 CellChangeTimes->{3.7698499700683813`*^9, 3.769850164215858*^9, 
  3.769850608415704*^9},ExpressionUUID->"afe29cfd-1389-4dd9-a2a5-\
e0b029093bff"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"me", "=", 
  RowBox[{"massMEexact", "[", 
   RowBox[{
    RowBox[{"mons", "[", 
     RowBox[{"[", "testrow", "]"}], "]"}], ",", 
    RowBox[{"mons", "[", 
     RowBox[{"[", "testcol", "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.76984997435513*^9, 
  3.769850020650839*^9}},ExpressionUUID->"40dd3850-2d68-4ea8-a885-\
2b0f4a642e43"],

Cell[BoxData[
 FractionBox["429", "67108864"]], "Output",
 CellChangeTimes->{{3.76985001208077*^9, 3.76985002238561*^9}, 
   3.769850166558271*^9, 
   3.769850621336832*^9},ExpressionUUID->"59a1b1e7-7366-468a-9dde-\
809c7e16d798"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["n\[GreaterEqual]3 particles", "Subsection",
 CellChangeTimes->{{3.769850480081286*^9, 
  3.769850495475038*^9}},ExpressionUUID->"4a7541f3-c50b-48d8-9aaf-\
91d0a7b1f99d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"npart", "=", "9"}], ";"}]], "Input",
 CellChangeTimes->{{3.769848806307423*^9, 3.7698488080914173`*^9}, {
  3.7698501822056017`*^9, 3.76985018237779*^9}, {3.769850888219401*^9, 
  3.7698508885696707`*^9}, {3.769851380458254*^9, 
  3.76985138131848*^9}},ExpressionUUID->"2620a117-57cb-4d1d-a167-\
1228bde14146"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"\"\</Users/khandker/Dropbox/Higher D Basis/Zuhair/Basis\>\"", "<>", 
    RowBox[{"ToString", "[", "npart", "]"}], "<>", "\"\<_Dmax16\>\""}], "]"}],
   ";"}]}], "Input",ExpressionUUID->"0257ff31-43b1-4a49-9bd5-8f9f8336475b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mons", "=", 
   RowBox[{"ToExpression", "[", 
    RowBox[{"\"\<mons\>\"", "<>", 
     RowBox[{"ToString", "[", "npart", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.769848871507718*^9, 3.769848872505576*^9}, 
   3.769848969459065*^9, 3.769849405333788*^9, 3.769849608792407*^9, 
   3.769850035911549*^9},ExpressionUUID->"b5e92a0a-0279-4c72-9ef2-\
047397ba38af"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"t1", "=", 
    RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"MonMassTable", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Fb1", "=", 
           RowBox[{
            RowBox[{"convertVariables", "[", 
             RowBox[{
              RowBox[{"convertMonomial", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "+", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"mons", "[", 
                  RowBox[{"[", "row", "]"}], "]"}]}], ",", "npart"}], "]"}], 
              ",", "npart"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Fb2", "=", 
           RowBox[{
            RowBox[{"convertVariables", "[", 
             RowBox[{
              RowBox[{"convertMonomial", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "+", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ")"}], "&"}], "/@", 
                 RowBox[{"mons", "[", 
                  RowBox[{"[", "col", "]"}], "]"}]}], ",", "npart"}], "]"}], 
              ",", "npart"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"massNik", "[", 
           RowBox[{"npart", ",", "Fb1", ",", "Fb2"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"row", ",", 
           RowBox[{"Length", "[", "mons", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"col", ",", "row"}], "}"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", ",", 
     RowBox[{"{", 
      RowBox[{"row", ",", "col"}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t2", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Elapsed Time: \>\"", "<>", 
   RowBox[{"ToString", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"t2", "-", "t1"}], ")"}], "/", "60"}], "//", "N"}], "]"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.76984895193386*^9, 3.7698490552684383`*^9}, {
  3.769849192867169*^9, 3.7698492069522543`*^9}, {3.7698492684325047`*^9, 
  3.7698493801576138`*^9}, {3.769849824186467*^9, 3.769849833683978*^9}, {
  3.76985064246588*^9, 
  3.769850644147169*^9}},ExpressionUUID->"c88b701a-f4d0-4541-ae11-\
bb6bb555c757"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{
  3.769852540639735*^9},ExpressionUUID->"16c3ef04-4765-4c7c-84e2-\
a7fba5bdc5cf"],

Cell[BoxData["\<\"Elapsed Time: 19.147\"\>"], "Print",
 CellChangeTimes->{3.7698498362064743`*^9, 3.76985011956981*^9, 
  3.769850281519866*^9, 3.7698507427157507`*^9, 3.769851054164741*^9, 
  3.769852540648053*^9},ExpressionUUID->"86b8627a-3ed3-4c23-a454-\
c043e615c71b"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MonMassPad", "=", 
   RowBox[{"PadRight", "[", "MonMassTable", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MonMass", "=", 
   RowBox[{"MonMassPad", "+", 
    RowBox[{"Transpose", "[", "MonMassPad", "]"}], "-", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"Diagonal", "[", "MonMassPad", "]"}], "]"}]}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.769849741405149*^9, 
  3.7698497665978394`*^9}},ExpressionUUID->"28297629-f94c-4140-a29f-\
b5eac07bada9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "Save", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MonMass10", "=", "MonMass"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filename", "=", 
     RowBox[{"\"\<./MonMass\>\"", "<>", 
      RowBox[{"ToString", "[", "npart", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeleteFile", "[", "filename", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Save", "[", 
     RowBox[{"filename", ",", "MonMass10"}], "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.769849845056245*^9, 3.769849883397709*^9}, {
  3.7698507536410313`*^9, 3.7698507583547688`*^9}, {3.7698512295549603`*^9, 
  3.769851235874721*^9}},ExpressionUUID->"47fd368a-0b74-4c74-89f1-\
cf8f6bb16235"],

Cell[BoxData[
 TemplateBox[{
  "DeleteFile","fdnfnd",
   "\"Directory or file \
\\!\\(\\*RowBox[{\\\"\\\\\\\"./MonMass10\\\\\\\"\\\"}]\\) not found.\"",2,49,
   1,29265952414116654868,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7698501417867737`*^9, 3.769850760618438*^9, 
  3.769851237042459*^9},ExpressionUUID->"6aa495a3-33f5-4527-b07d-\
28a35dd89cdc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Some", " ", 
    RowBox[{"Checks", ".", " ", "Run"}], " ", "My", " ", "code", " ", "in", 
    " ", "Check24v6"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"testrow", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"testcol", "=", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{"Length", "[", "mons", "]"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.769849934723962*^9, 
  3.769849944145698*^9}},ExpressionUUID->"3424139e-1da2-4cf2-97ff-\
44fd19101272"],

Cell[BoxData["40"], "Output",
 CellChangeTimes->{{3.769849940209536*^9, 3.7698499476013737`*^9}, 
   3.7698501623882513`*^9, {3.769850770348247*^9, 3.769850793033959*^9}, 
   3.7698508625967827`*^9},ExpressionUUID->"82986e2a-6caf-410c-a3c3-\
f0eb16c817c8"],

Cell[BoxData["58"], "Output",
 CellChangeTimes->{{3.769849940209536*^9, 3.7698499476013737`*^9}, 
   3.7698501623882513`*^9, {3.769850770348247*^9, 3.769850793033959*^9}, 
   3.76985086260666*^9},ExpressionUUID->"964b4a26-0d7b-4122-bf80-\
df8237a59e8b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"code", "=", 
  RowBox[{"MonMass", "[", 
   RowBox[{"[", 
    RowBox[{"testrow", ",", "testcol"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7698499558243628`*^9, 
  3.7698499693936243`*^9}},ExpressionUUID->"0853f817-5da6-4abd-8cfe-\
054da99b2216"],

Cell[BoxData[
 FractionBox["6359", 
  RowBox[{"88455673019723040", " ", "\[Pi]"}]]], "Output",
 CellChangeTimes->{
  3.7698499700683813`*^9, 3.769850164215858*^9, {3.769850774240213*^9, 
   3.7698507939513206`*^9}, 
   3.769850863612831*^9},ExpressionUUID->"1cf8f723-552e-4d7d-992f-\
cfd5e410e438"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"me", "=", 
  RowBox[{"massMEexact", "[", 
   RowBox[{
    RowBox[{"mons", "[", 
     RowBox[{"[", "testrow", "]"}], "]"}], ",", 
    RowBox[{"mons", "[", 
     RowBox[{"[", "testcol", "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.76984997435513*^9, 
  3.769850020650839*^9}},ExpressionUUID->"7b7a4a99-3bd0-4fde-81fa-\
a4f7e55c6f86"],

Cell[BoxData[
 FractionBox["6359", 
  RowBox[{"88455673019723040", " ", "\[Pi]"}]]], "Output",
 CellChangeTimes->{{3.76985001208077*^9, 3.76985002238561*^9}, 
   3.769850166558271*^9, {3.7698507773405313`*^9, 3.769850790797958*^9}, {
   3.7698508604433517`*^9, 
   3.76985086495369*^9}},ExpressionUUID->"898b375d-7a16-4d07-adbb-\
3cb0a2ea8b09"]
}, Open  ]]
}, Open  ]]
}, Closed]]
},
WindowSize->{920, 651},
WindowMargins->{{Automatic, 1}, {Automatic, 0}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->FrontEnd`FileName[{"Report"}, "StandardReport.nb", 
  CharacterEncoding -> "UTF-8"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 410, 6, 69, "Section",ExpressionUUID->"8e05bc19-2993-4905-85ee-d7bf15563fee"],
Cell[993, 30, 1028, 15, 41, "Input",ExpressionUUID->"317c3153-e78a-4806-b09b-e2c3428bd8f7"]
}, Closed]],
Cell[CellGroupData[{
Cell[2058, 50, 163, 3, 55, "Section",ExpressionUUID->"b77a3eab-9c73-4334-a97e-3147300f1334"],
Cell[2224, 55, 8527, 212, 790, "Input",ExpressionUUID->"eaeb05b4-5907-43f9-bef9-c51d62833519"]
}, Closed]],
Cell[CellGroupData[{
Cell[10788, 272, 356, 8, 55, "Section",ExpressionUUID->"03500836-ede0-496f-978d-a084bd17f95d"],
Cell[CellGroupData[{
Cell[11169, 284, 234, 6, 34, "Subsection",ExpressionUUID->"f6fa6735-b55b-4e96-9791-7c43f0a95174"],
Cell[11406, 292, 20662, 509, 1831, "Input",ExpressionUUID->"5dde0b0b-b31f-4b31-b827-9f044c550f8b"]
}, Closed]],
Cell[CellGroupData[{
Cell[32105, 806, 163, 3, 34, "Subsection",ExpressionUUID->"ec949f04-af7c-4a9d-bfd7-fa24d461f4f2"],
Cell[32271, 811, 32467, 788, 1867, "Input",ExpressionUUID->"d5a7316d-28b6-4f9b-bbfc-936ef7fb32c4"]
}, Closed]],
Cell[CellGroupData[{
Cell[64775, 1604, 157, 3, 34, "Subsection",ExpressionUUID->"2a83f87c-5091-47b6-9186-e61f4272cc4f"],
Cell[64935, 1609, 30375, 689, 1772, "Input",ExpressionUUID->"95b65eff-9a51-417a-8452-a4b0989dbec5"]
}, Closed]],
Cell[CellGroupData[{
Cell[95347, 2303, 157, 3, 34, "Subsection",ExpressionUUID->"ea567448-48d2-47f2-88a4-3f9b2d6fb8f2"],
Cell[95507, 2308, 442, 9, 49, "Text",ExpressionUUID->"b767e2ff-0572-425e-9302-18e27aa00ce0"],
Cell[95952, 2319, 12103, 264, 824, "Input",ExpressionUUID->"3608d25e-e980-4e35-b2d7-987d7bee4a43"],
Cell[108058, 2585, 412, 8, 30, "Text",ExpressionUUID->"6d34ac79-9b36-4ace-aa52-11e2da8e173f"],
Cell[108473, 2595, 3342, 91, 292, "Input",ExpressionUUID->"45f23581-d17e-447d-b417-4d4cf611ca47"],
Cell[111818, 2688, 2616, 74, 322, "Input",ExpressionUUID->"456eb8e9-7ae6-4d87-b3ee-034b85224455"],
Cell[114437, 2764, 422, 8, 30, "Text",ExpressionUUID->"cc663e28-155e-47cb-a8fb-00fbd88a1325"],
Cell[114862, 2774, 42727, 981, 1937, "Input",ExpressionUUID->"47d6b581-d7c3-409a-b321-ec7c8a9df0de"],
Cell[157592, 3757, 300, 7, 30, "Text",ExpressionUUID->"233f02b0-b886-410e-9df7-f25c69d132a2"],
Cell[157895, 3766, 43798, 1005, 1958, "Input",ExpressionUUID->"47d6b581-d7c3-409a-b321-ec7c8a9df0de"]
}, Closed]],
Cell[CellGroupData[{
Cell[201730, 4776, 161, 3, 34, "Subsection",ExpressionUUID->"f44a8dec-4a9f-4959-9569-96c2854f58a0"],
Cell[201894, 4781, 621, 15, 41, "Text",ExpressionUUID->"8f6c68e1-b921-4d5e-a090-bbdfd4e39f07"],
Cell[202518, 4798, 9900, 215, 693, "Input",ExpressionUUID->"adeaae51-2987-44ad-bbdd-f35b3c3be810"],
Cell[212421, 5015, 155, 3, 30, "Text",ExpressionUUID->"b495b347-055d-4c1c-a85d-5c33a61de151"],
Cell[212579, 5020, 49009, 1114, 2236, "Input",ExpressionUUID->"0d4af10a-98ad-4c1f-81a2-24e5097da687"],
Cell[261591, 6136, 451, 13, 41, "Text",ExpressionUUID->"683d85d8-523a-4352-ad39-66cc0d7c5918"],
Cell[262045, 6151, 6036, 152, 611, "Input",ExpressionUUID->"82242f92-c996-48df-bcaa-eba1080a6446"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[268130, 6309, 158, 3, 55, "Section",ExpressionUUID->"5fc41128-4e6b-4bdb-a4fa-5f44de63bc01"],
Cell[268291, 6314, 747, 12, 41, "Input",ExpressionUUID->"cede10b9-3810-4304-90c6-6bb0127d5aee"],
Cell[269041, 6328, 521, 13, 84, "Input",ExpressionUUID->"74273777-6f2b-4df9-bd50-aef953f1b321"],
Cell[269565, 6343, 268, 6, 41, "Input",ExpressionUUID->"df0a5356-557b-4db3-8aeb-a1f9e8a2b416"],
Cell[CellGroupData[{
Cell[269858, 6353, 205, 3, 41, "Input",ExpressionUUID->"05335499-8cdd-4c84-9790-761f5cd60414"],
Cell[270066, 6358, 270, 4, 41, "Output",ExpressionUUID->"90359ebb-b70f-446a-b4f0-8f56a29e2b66"]
}, Open  ]],
Cell[CellGroupData[{
Cell[270373, 6367, 1430, 41, 189, "Input",ExpressionUUID->"2d89f45b-1deb-4554-b5e0-286566d98d3a"],
Cell[271806, 6410, 483, 8, 24, "Print",ExpressionUUID->"630bef71-df88-48ef-92e5-f60537cd72d4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[272326, 6423, 310, 7, 41, "Input",ExpressionUUID->"a7f13bca-9bac-4456-965e-1322d84203a2"],
Cell[272639, 6432, 166, 2, 41, "Output",ExpressionUUID->"58b5e866-f87b-4f68-bfb5-83889954f7fa"]
}, Open  ]],
Cell[272820, 6437, 463, 12, 63, "Input",ExpressionUUID->"edd03a0e-3bb0-4898-beab-30291d6fd28e"],
Cell[CellGroupData[{
Cell[273308, 6453, 1539, 33, 147, "Input",ExpressionUUID->"e685409f-3bbf-4958-bd16-f316f11c6f18"],
Cell[274850, 6488, 659, 14, 24, "Message",ExpressionUUID->"b5a9e2b7-e716-494f-806e-dc530bf953b9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[275546, 6507, 614, 14, 84, "Input",ExpressionUUID->"f6f2dffc-0543-4244-a796-0fd4a072eba2"],
Cell[276163, 6523, 648, 9, 41, "Output",ExpressionUUID->"58dcd2de-ff9e-40ef-a3c9-972d8978838f"],
Cell[276814, 6534, 649, 9, 41, "Output",ExpressionUUID->"81e0f6b7-0ee5-46a9-99fa-14dca56e22a6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[277500, 6548, 290, 6, 41, "Input",ExpressionUUID->"ae09387a-8d05-483b-83b5-78146aa868f6"],
Cell[277793, 6556, 655, 11, 58, "Output",ExpressionUUID->"2840b703-0522-4e39-a3c6-fa781ddf0ca5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[278485, 6572, 1552, 46, 84, "Input",ExpressionUUID->"66172432-8d7b-49d4-ad44-a273ad6650a5"],
Cell[280040, 6620, 506, 9, 58, "Output",ExpressionUUID->"2bab8cc8-b2fa-4f32-a69d-276877765d6b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[280583, 6634, 202, 3, 41, "Input",ExpressionUUID->"0de5b142-7992-43f9-9a2a-0c0a5c086ff2"],
Cell[280788, 6639, 344, 5, 41, "Output",ExpressionUUID->"9c74d39a-a5a0-4432-a0df-25d72e742d0f"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[281181, 6650, 205, 4, 69, "Section",ExpressionUUID->"b5b41cbe-b011-4fe7-a931-d410b88b5668"],
Cell[CellGroupData[{
Cell[281411, 6658, 163, 3, 32, "Subsection",ExpressionUUID->"60e2828b-62d9-48b3-ba92-175009d71159"],
Cell[281577, 6663, 295, 6, 41, "Input",ExpressionUUID->"b4af1a59-3701-4861-b0fd-1a11a889cf4a"],
Cell[281875, 6671, 410, 9, 63, "Input",ExpressionUUID->"160fbeb2-27d8-41ca-a7e3-ff1b543f61bd"],
Cell[282288, 6682, 458, 10, 41, "Input",ExpressionUUID->"22d84de8-0f21-4b7f-a004-7887f98905bf"],
Cell[CellGroupData[{
Cell[282771, 6696, 2988, 80, 252, "Input",ExpressionUUID->"aa6df6ef-66f6-4f26-91ac-b5c4fb149190"],
Cell[285762, 6778, 256, 4, 24, "Print",ExpressionUUID->"a734f36a-01aa-446c-82b7-7703eccd8b55"]
}, Open  ]],
Cell[286033, 6785, 512, 14, 63, "Input",ExpressionUUID->"8c635989-42e7-4b6e-904e-28516b99ab3d"],
Cell[CellGroupData[{
Cell[286570, 6803, 821, 23, 147, "Input",ExpressionUUID->"547e1e98-820f-42bf-9ad9-fce41358660c"],
Cell[287394, 6828, 333, 8, 24, "Message",ExpressionUUID->"37befe42-e6f6-4126-ae75-3023a3fd51f0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[287764, 6841, 613, 15, 84, "Input",ExpressionUUID->"ca490eb9-93da-4a1f-8ed7-00471eb6a484"],
Cell[288380, 6858, 207, 4, 41, "Output",ExpressionUUID->"aa15ba18-122a-473e-82ca-24b13ed07894"],
Cell[288590, 6864, 207, 4, 41, "Output",ExpressionUUID->"1d481fdc-7c6a-4e8b-bfa8-466b379ccc46"]
}, Open  ]],
Cell[CellGroupData[{
Cell[288834, 6873, 277, 7, 41, "Input",ExpressionUUID->"3c4f6f34-1e54-486f-b6c7-69befea18f3a"],
Cell[289114, 6882, 205, 4, 58, "Output",ExpressionUUID->"afe29cfd-1389-4dd9-a2a5-e0b029093bff"]
}, Open  ]],
Cell[CellGroupData[{
Cell[289356, 6891, 367, 10, 41, "Input",ExpressionUUID->"40dd3850-2d68-4ea8-a885-2b0f4a642e43"],
Cell[289726, 6903, 230, 5, 58, "Output",ExpressionUUID->"59a1b1e7-7366-468a-9dde-809c7e16d798"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[290005, 6914, 175, 3, 32, "Subsection",ExpressionUUID->"4a7541f3-c50b-48d8-9aaf-91d0a7b1f99d"],
Cell[290183, 6919, 345, 7, 41, "Input",ExpressionUUID->"2620a117-57cb-4d1d-a167-1228bde14146"],
Cell[290531, 6928, 410, 9, 63, "Input",ExpressionUUID->"0257ff31-43b1-4a49-9bd5-8f9f8336475b"],
Cell[290944, 6939, 408, 9, 41, "Input",ExpressionUUID->"b5e92a0a-0279-4c72-9ef2-047397ba38af"],
Cell[CellGroupData[{
Cell[291377, 6952, 3016, 80, 252, "Input",ExpressionUUID->"c88b701a-f4d0-4541-ae11-bb6bb555c757"],
Cell[294396, 7034, 137, 3, 41, "Output",ExpressionUUID->"16c3ef04-4765-4c7c-84e2-a7fba5bdc5cf"],
Cell[294536, 7039, 272, 4, 24, "Print",ExpressionUUID->"86b8627a-3ed3-4c23-a454-c043e615c71b"]
}, Open  ]],
Cell[294823, 7046, 512, 14, 63, "Input",ExpressionUUID->"28297629-f94c-4140-a29f-b5eac07bada9"],
Cell[CellGroupData[{
Cell[295360, 7064, 924, 24, 147, "Input",ExpressionUUID->"47fd368a-0b74-4c74-89f1-cf8f6bb16235"],
Cell[296287, 7090, 382, 9, 24, "Message",ExpressionUUID->"6aa495a3-33f5-4527-b07d-28a35dd89cdc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[296706, 7104, 613, 15, 84, "Input",ExpressionUUID->"3424139e-1da2-4cf2-97ff-44fd19101272"],
Cell[297322, 7121, 256, 4, 41, "Output",ExpressionUUID->"82986e2a-6caf-410c-a3c3-f0eb16c817c8"],
Cell[297581, 7127, 253, 4, 41, "Output",ExpressionUUID->"964b4a26-0d7b-4122-bf80-df8237a59e8b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[297871, 7136, 277, 7, 41, "Input",ExpressionUUID->"0853f817-5da6-4abd-8cfe-054da99b2216"],
Cell[298151, 7145, 298, 7, 58, "Output",ExpressionUUID->"1cf8f723-552e-4d7d-992f-cfd5e410e438"]
}, Open  ]],
Cell[CellGroupData[{
Cell[298486, 7157, 367, 10, 41, "Input",ExpressionUUID->"7b7a4a99-3bd0-4fde-81fa-a4f7e55c6f86"],
Cell[298856, 7169, 344, 7, 58, "Output",ExpressionUUID->"898b375d-7a16-4d07-adbb-3cb0a2ea8b09"]
}, Open  ]]
}, Open  ]]
}, Closed]]
}
]
*)

